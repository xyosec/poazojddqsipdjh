"use strict";(self.webpackChunkdoctolib=self.webpackChunkdoctolib||[]).push([[3057],{17343:(e,t,n)=>{n.d(t,{A:()=>u,k:()=>o.TrackingEventItemContext});var r=n(89482),a=n(49564),o=n(8029),c=n(18809);const u=e=>{let{itemId:t=null,itemType:n=null,value:u,children:s}=e;const i=(0,r.useContext)(o.TrackingEventItemContext),d=(0,r.useContext)(a.A),l=(0,r.useMemo)((()=>({...i,itemId:t,itemType:n})),[i,t,n]),m=(0,r.useMemo)((()=>({...d,...u})),[d,u]);return(0,c.jsx)(o.TrackingEventItemContext.Provider,{value:l,children:(0,c.jsx)(a.A.Provider,{value:m,children:s})})}},50342:(e,t,n)=>{n.d(t,{H:()=>o,V:()=>c});var r=n(19365),a=n(18809);const o={main:"dark-teal",relative:"dark-purple"},c=e=>{let{masterPatient:t,size:n}=e;const c="main"===t.kind?o.main:o.relative;return(0,a.jsx)(r.eu,{className:"test-preserve-color-for-argos",text:(0,r.IM)(t),size:n,color:c})}},96356:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var r=n(30079),a=n(49346),o=n(10244),c=n(31330),u=n(9348),s=n(33350),i=n(76312),d=n(17343),l=n(95936),m=n(18809);const p=()=>{const e=(0,o.Ay)(),t=(0,c.Ay)(),{tankerIsReady:n,enrollInTanker:p}=(0,i.A)(!1),y=(0,l.wA)();return!e||e.should_verify_email_address?null:(0,r.lV)()?(0,m.jsx)(d.A,{value:{source:"document_drive"},children:(0,m.jsx)(u.A,{onUpload:()=>{t({message:a.A.t("helpers.appointment.patient_documents.saved"),uiStyle:"success"}),y()},source:s.p.Native,enrollInTanker:p,tankerIsReady:n,startTankerOnMount:!0})}):null}},25343:(e,t,n)=>{n.d(t,{k:()=>i,s:()=>d});var r=n(49346),a=n(89482),o=n(3877),c=n(81311),u=n(10244),s=n(31330);async function i(e,t,n){if(!n||!e.tanker_encrypted_title)return e;try{return await t({title:!0},e,"decryptPatientAccountDocumentTitle",{subject_type:"PatientAccountDocuments::Document",subject_id:e.id})}catch(t){if(t.message.startsWith("could not find key for resource"))return c.Ay.post("/account/documents/tanker_errors",{body:{document_id:e.id,comment:"decrypt_title"}}),{...e,tanker_encrypted_title:void 0};throw t}}const d=(e,t)=>{const n=(0,u.Ay)(),{decryptRecord:c,refreshGroups:d}=(0,a.useContext)(o.to),l=(0,s.Ay)(),[m,p]=(0,a.useState)(e),y=(0,a.useCallback)((async e=>{const t=await async function(e,t,n,a){return Promise.all(e.map((e=>i(e,t,n).catch((()=>(a({message:r.A.t("tanker.errors.temporary_error"),uiStyle:"error"}),{...e,tanker_encrypted_title:void 0}))))))}(e,c,n,l);p(t)}),[n,c,l]);return(0,a.useEffect)((()=>{t?y(e):p(e)}),[e,t,y]),{decryptedDocuments:m,refreshGroups:d}}},95936:(e,t,n)=>{n.d(t,{J9:()=>g,eP:()=>v,eq:()=>A,j0:()=>f,qB:()=>_,wA:()=>y,z6:()=>P});var r=n(87117),a=n(89482),o=n(94820),c=n(10244),u=n(3877),s=n(25343),i=n(50604),d=n(35138),l=n(99847);const m=e=>["account","documents",e],p=e=>["account","documents",{master_patient_id:e}],y=function(){let{masterPatientId:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=(0,r.useQueryClient)();return()=>t.invalidateQueries({queryKey:p(e)})},_=function(){let{masterPatientId:e,enabled:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{enabled:!0};const n=(0,c.Ay)(),u=(0,a.useContext)(o.Pl),{activated:s}=(0,l.Mn)("document_drive"),i=Boolean(null===n||void 0===n?void 0:n.id),d=Boolean(s);return(0,r.useInfiniteQuery)({queryKey:p(e),queryFn:t=>{let{pageParam:n}=t;return u.get("/account/documents.json",{query:{page:n,master_patient_id:e}}).then((e=>{let{bodyData:t}=e;return t}))},initialPageParam:1,enabled:i&&d&&Boolean(t),getNextPageParam:e=>{if(!e.last_page)return e.current_page+1}})},v=function(){let{documentsFilter:e,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{enabled:!0};const{data:n,...r}=_(t);return{...r,documents:(0,a.useMemo)((()=>{const t=e?t=>t.documents.filter(e):e=>e.documents;return(null===n||void 0===n?void 0:n.pages.flatMap(t))||[]}),[n,e])}};function h(e,t,n){if(!e)return;const r=e.pages.map((e=>function(e,t,n){switch(n){case d.H.READ:case d.H.UPDATE:return{current_page:e.current_page,documents:e.documents.map((e=>e.id===t.id?t:e)),last_page:e.last_page};default:throw new Error("Unexpected operation kind to perform on cache invalidation")}}(e,t,n)));return{pages:r,pageParams:e.pageParams}}const f=function(){let{masterPatientId:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=(0,r.useQueryClient)(),n=(0,a.useContext)(i.A),o=p(e);return async(e,r)=>{null===n||void 0===n||n.updateUnreadDocument(e),r!==d.H.DELETE?(await t.cancelQueries({queryKey:o}),t.setQueryData(o,(t=>h(t,e,r)))):await t.invalidateQueries({queryKey:o})}},g=e=>{let{patientAccountDocumentId:t,onSuccess:n}=e;const c=(0,a.useContext)(o.Pl),u=(0,r.useQueryClient)();return(0,r.useMutation)({mutationFn:async e=>{let{title:n,tanker_encrypted_title:r}=e;return c.put("/account/documents/".concat(t),{body:{title:n,tanker_encrypted_title:r}})},onSuccess:(e,r)=>(u.invalidateQueries({queryKey:m(t)}),null===n||void 0===n?void 0:n(r))})},P=e=>{let{patientAccountDocumentId:t,enabled:n=!0}=e;const i=(0,a.useContext)(o.Pl),d=(0,c.Ay)(),{decryptRecord:l}=(0,a.useContext)(u.to);return(0,r.useQuery)({queryKey:m(t),queryFn:()=>i.get("/account/documents/".concat(t)).then((e=>{let{bodyData:t}=e;return(0,s.k)(t,l,d).catch((e=>(window.crashReporter.captureException(e,{tags:{component:"useDocumentsShow",transactionTeam:"phr"}}),{...t,tanker_encrypted_title:void 0})))})).catch((()=>null)),enabled:Boolean(n)&&Boolean(t)})},A=e=>{let{patientAccountDocumentId:t,onSuccess:n,onError:c}=e;const u=(0,a.useContext)(o.Pl);return(0,r.useMutation)({mutationFn:async()=>u.delete("/account/documents/".concat(t)),onSuccess:n,onError:c})}},79003:(e,t,n)=>{n.d(t,{N:()=>r});const r=50},55820:(e,t,n)=>{n.d(t,{C:()=>o,r:()=>c});var r=n(33858),a=n(40874);const o=async e=>{let{title:t,masterPatientId:n,encryptRecord:o}=e;const c=[{masterPatientId:n}];(0,r.G7)("phr_documents_ocr_encryption")&&c.push({e2se:a.Q.DOCUMENT_OCR});return(await o({title:{shareWith:c}},{title:t},"encryptPatientAccountDocumentValues",{subject_type:"PatientAccountDocuments::Document",subject_id:null})).tanker_encrypted_title},c=async e=>{let{fileToUpload:t,masterPatientId:n,agendaId:o,encryptFile:c,trackingContext:u={}}=e;const s=[{masterPatientId:n}];o&&s.push({agendaId:o,role:"sync"},{agendaId:o}),(0,r.G7)("phr_documents_ocr_encryption")&&s.push({e2se:a.Q.DOCUMENT_OCR});const{encryptedFile:i}=await c(t,s,void 0,void 0,u);if(!i)throw new Error("There is no file");return i}},35138:(e,t,n)=>{n.d(t,{H:()=>r});let r=function(e){return e[e.READ=0]="READ",e[e.UPDATE=1]="UPDATE",e[e.DELETE=2]="DELETE",e}({})},47815:(e,t,n)=>{n.d(t,{P:()=>o,q:()=>c});var r=n(89482),a=n(18809);const o=(0,r.createContext)({}),c=e=>{let{value:t,children:n}=e;const c=(0,r.useContext)(o),u=(0,r.useMemo)((()=>({...c,...t})),[c,t]);return(0,a.jsx)(o.Provider,{value:u,children:n})}},13543:(e,t,n)=>{n.d(t,{$:()=>a});var r=n(76606);function a(e,t){(0,r.cP)({name:e.name,team:"PHR",schema:"patient",details:{product_brick_name:"document_and_information_management_for_patient",...e.details,...t}})}},33029:(e,t,n)=>{n.d(t,{A:()=>r});const r=(0,n(42691).A)((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]}))}}]);
//# sourceMappingURL=../3057-d6925425bc91801131fc.js.map