"use strict";(self.webpackChunkdoctolib=self.webpackChunkdoctolib||[]).push([[9678],{99178:(e,t,n)=>{n.d(t,{_:()=>h,l:()=>v});var o=n(76609),a=n(78496),r=n(69447),i=n(12872),s=n(44248),l=n(81277),c=n(30079),u=n(17679),d=n(46961),m=n(80044),p=n(57332),_=n(40874);const h=async(e,t,n)=>{let{tankerContext:o,login:r}=e;try{const{tanker:e}=await o.startTankerWithVerificationMethod(t,{passphrase:n.password}),a={preverifiedEmail:n.email};await(0,_.nJ)({tanker:e,account:t,verificationMethod:a}),await(0,_.Wg)(t,e)}catch(e){(0,i.C)(e)}r(t),(0,c.lV)()&&await(async()=>{const e=await l.ct.call({method:s.Ni});await a.A.saveNotificationToken({token:{...e,permission:(0,m.kR)(e.permission)}}).catch((()=>{}))})()},v=async(e,t,n)=>{var a,s;let{password:l,username:c,remember_username:m,refresh_token:h}=n;if(null!==(a=t.tanker_identity)&&void 0!==a&&a.passphrase_registered_at&&await e.updatePassphraseVerificationMethod({account:t,currentPassword:l,newPassword:l,trackingOrigin:"login_form"}),(0,d.l3)("3.4.23")&&h)try{await(0,u.mo)(c,h)}catch(e){}if(!t.two_factor_auth_response){if(null!==(s=t.tanker_identity)&&void 0!==s&&s.email_registered_at){await(async(e,t)=>{try{var n;const{registeredEmail:o}=await e.checkTankerStatus(t),a=null===o||void 0===o?void 0:o.toLowerCase(),i=null===(n=t.email)||void 0===n?void 0:n.toLowerCase();(0,r.Ay)({name:"emails_are_in_sync",details:{success:a===i}},{schema:"tanker_event"})}catch(e){}})(e,t);try{var v;await e.refreshGroups(t,{verificationMethod:l?{passphrase:l}:null,byPassPostStartChecks:!(0,p.A)("bypass_patient_email_verification")&&(null===(v=t.tanker_identity)||void 0===v?void 0:v.passphrase_registered_at)})}catch(e){(0,i.C)(e)}}if(!(0,p.A)("bypass_patient_email_verification"))try{var g;(null!==(g=t.tanker_identity)&&void 0!==g&&g.passphrase_registered_at||t.should_verify_email_address)&&await e.startTankerWithVerificationMethod(t,{passphrase:l})}catch(e){window.crashReporter.captureException(e)}if(t.tanker_identity){const{isReady:n}=await e.checkTankerStatus(t);if(n)try{const{tanker:n}=await e.startTanker(t,{byPassPostStartChecks:!0});await(0,_.Wg)(t,n)}catch(e){(0,i.C)(e)}}m?o.hZ("last-login-username",c):o.TF("last-login-username")}}},96005:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(15672),a=n(80879),r=n(18809);const i=e=>{let{onChange:t,onBlur:n,...i}=e;return(0,r.jsx)(o.D0,{...i,"data-design-system":"base",children:e=>{let{value:o,setValue:s,setTouched:l,fieldName:c}=e;return(0,r.jsx)(a.S,{...i,checked:!!o,name:c,onChange:e=>{s(e.target.checked),t&&t(e.target.checked,e)},onBlur:e=>{l(),n&&n(e)}})}})}},3667:(e,t,n)=>{n.d(t,{A:()=>d});var o=n(49346),a=n(24941),r=n(15672),i=n(90468),s=n(18909),l=n(38155),c=n(18809);const u="legal_gender",d=e=>{let{disabled:t=!1,label:n=o.A.t("patient_mobile.root.account.edit.gender.gender"),required:d,placeholder:m=o.A.t("patient_mobile.root.account.edit.gender.gender")}=e;const p=(0,r.WZ)(),_=(0,l.A)();return(0,c.jsx)(s.A,{label:n,children:(0,c.jsx)(a.A,{children:(0,c.jsx)(i.A,{id:"legal-gender-selector",options:_,onChange:e=>{switch(e){case l.f.FEMALE:p.setValue("gender",!0);break;case l.f.MALE:p.setValue("gender",!1);break;default:p.setValue("gender",null)}p.setValue(u,e)},disabled:t,placeholder:m,name:"legal_gender",value:p.getValue(u),required:d})})})}},88320:(e,t,n)=>{n.d(t,{F:()=>a});const o=/^((?![\d/\\<>])[\p{L}\s!-\u2010\u2014\u2013'.\xb7\u2019]){1,100}$/u,a=e=>!!e&&!o.test(e)},22421:(e,t,n)=>{n.d(t,{A:()=>y});var o=n(84583),a=n.n(o),r=n(92457),i=n(30079),s=n(64422),l=n(3126),c=n(41591),u=n(18809);const d=e=>{var t,n;let{modalInfo:o,errors:a,values:r,onModalSubmit:i,isSubmitting:d,onModalDismiss:m}=e;const p=!a&&d&&!!o;return(null===o||void 0===o?void 0:o.reason)===s.A.PasswordExpired?(0,u.jsx)(l.A,{onHide:m}):(0,u.jsx)(c.A,{isModalVisible:p,username:null===o||void 0===o||null===(t=o.data)||void 0===t?void 0:t.value,usernameType:null===o||void 0===o||null===(n=o.data)||void 0===n?void 0:n.usernameType,onModalSubmit:()=>i(r),onModalDismiss:m,reason:null===o||void 0===o?void 0:o.reason})};var m=n(73443),p=n(62309),_=n(68381),h=n(81478);const v=e=>e!==h.a.AUTHENTICATION_CHOICE_STEP&&e?e:"/",g=e=>{let{authenticationState:t,formApi:n,onStepSubmit:o,stepsForRoutes:a,title:r}=e;return(0,u.jsx)(_.Routes,{children:a.map((e=>{let{component:a,path:i}=e;return(0,u.jsx)(_.Route,{path:v(i),element:a&&(0,u.jsx)(a,{formApi:n,state:t,onStepSubmit:o,title:r})},i)}))})},y=e=>{let{currentStep:t,formApi:n,onModalSubmit:o,onModalDismiss:s,onStepSubmit:l,onChangeForm:c,state:_,steps:v,stepsForRoutes:y}=e;return(0,u.jsx)("div",{className:a()("dl-scrollable flex flex-col justify-between",{"bg-white":t.path!==h.a.AUTHENTICATION_CHOICE_STEP,"dl-full-height":(0,i.G9)()}),children:(0,u.jsx)(r.A,{className:a()("flex flex-col justify-between",{"p-16":(0,i.G9)()}),autoComplete:"off",horizontal:!1,requiredIndicators:!1,defaultValues:_.data,onSubmit:e=>l(e),onChange:e=>c(e.values),children:e=>(n.current=e,(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(g,{authenticationState:_,formApi:n.current,onStepSubmit:l,stepsForRoutes:y,title:t.cardTitle||t.title}),(0,u.jsx)(d,{modalInfo:_.showModal,errors:n.current.errors,values:n.current.values,onModalSubmit:o,onModalDismiss:s,isSubmitting:_.continueButtonDisabled}),m.P.isStepperVisible(t.path)&&(0,u.jsx)(p.A,{hideProgress:m.P.isProgressBarHidden(t.path),currentStep:v.findIndex((e=>e.path===t.path))+1,totalStep:v.length,disabled:_.continueButtonDisabled,loading:_.loading})]}))})})}},81478:(e,t,n)=>{n.d(t,{W:()=>a,a:()=>o});let o=function(e){return e.AUTHENTICATION_CHOICE_STEP="choice",e.USERNAME_SIGN_UP_STEP="username_sign_up",e.USERNAME_SIGN_IN_STEP="username_sign_in",e.ANONYMOUS_RESOURCE_SIGN_IN_STEP="anonymous_resource_sign_in",e.IDENTITY_STEP="identity",e.PASSWORD_STEP="password",e.VERIFY_PHONE_NUMBER_STEP="phone_number",e.LEGAL_TERMS_STEP="privacy_policy",e.LOGIN_STEP="login",e.ANONYMOUS_RESOURCE_LOGIN_STEP="anonymous_resource_login",e.VERIFICATION_CODE_STEP="sms_validation",e.VERIFY_EMAIL_STEP="email",e.ANONYMOUS_RESOURCE_VERIFY_EMAIL_STEP="anonymous_resource_email",e.ANONYMOUS_RESOURCE_VERIFY_PHONE_NUMBER_STEP="anonymous_resource_phone_number",e.MARKETING_OPT_IN_STEP="marketing_optin",e}({}),a=function(e){return e.SIGNUP="signup",e.LOGIN="login",e}({})},73443:(e,t,n)=>{n.d(t,{P:()=>a});var o=n(81478);const a={isAccountCreationStep:e=>e===o.a.LEGAL_TERMS_STEP,isProgressBarHidden:e=>e===o.a.LOGIN_STEP,isFormFilledIn:(e,t,n)=>e||n.slice(0,3).some((e=>e.path===t)),isStepperVisible:e=>e!==o.a.AUTHENTICATION_CHOICE_STEP}},13926:(e,t,n)=>{n.d(t,{A:()=>mt,F:()=>dt});var o=n(89482),a=n(68381),r=n(75432),i=n(58215),s=n(50664),l=n(76609),c=n(3877),u=n(10244),d=n(11658),m=n(49346),p=n(81478),_=n(36411),h=n(52651),v=n(56376),g=n(30079),y=n(98392),E=n(87973),A=n(18809);const b=e=>{let{state:t,formApi:n,label:a,placeholder:r}=e;const[i,s]=(0,o.useState)(null),l=(0,o.useRef)(),c=a||"appointments.login_or_signup.email_or_phonenumber_step.label";return(0,o.useEffect)((()=>{var e;return s(null!==(e=null===t||void 0===t?void 0:t.error)&&void 0!==e?e:null)}),[t.error,null===n||void 0===n?void 0:n.submits]),(0,o.useEffect)((()=>{t.showModal||setTimeout((()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.focus()}),500)}),[t.showModal]),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(E.A,{name:"envelope"}),(0,A.jsx)(_.o,{level:"h1",uiStyle:"title-l-bold",customStyle:["!mt-16"],children:m.A.t(c)}),(0,A.jsx)(h.A,{autoCapitalize:"off",autoComplete:"off",autoCorrect:"off",className:"!mt-16 !mb-0",ref:l,id:"username",field:"username",label:"",type:"text",error:Boolean(i),placeholder:null!==r&&void 0!==r?r:m.A.t("appointments.login_or_signup.email_or_phonenumber_step.placeholder"),required:!0,validate:e=>!!e&&!((e=>/^[\w+\-.]+@[a-z0-9-]+(\.[a-z0-9-]+)*\.[a-z0-9]+$/i.test(e))(e)||(e=>(0,v.gf)((0,g.JJ)(),e))(e))}),i&&(0,A.jsx)(y.A,{uiStyle:"body-xs-regular",color:"error-090","aria-live":"polite",children:i})]})};var f=n(63388),N=n(70093),S=n(84583),x=n.n(S),T=n(88320),w=n(33858),I=n(86709),P=n(15672),R=n(13139),O=n(3736),j=n(18909);const C=e=>{let{disabled:t,label:n,required:o,showSubtext:a=!1}=e;const r=(0,P.WZ)(),i=[{value:R.u.Female,label:m.A.t("common.biological_sex_options.female"),required:o},{value:R.u.Male,label:m.A.t("common.biological_sex_options.male"),required:o}];return(0,A.jsxs)(j.A,{label:n,children:[(0,A.jsx)(I.A,{children:(0,A.jsx)(O.F,{label:n,name:"biological_sex",containerClassName:"grid grid-flow-col auto-cols-fr flex-1 dl-compact-radio-card-container",className:"flex dl-align-items-start dl-flex-grow-2 dl-compact-radio-card",disabled:t,options:i,type:"radio",value:r.getValue("biological_sex"),onSelect:e=>r.setValue("biological_sex",e)})}),a&&(0,A.jsx)(N.E,{block:!0,uiStyle:"body-xs-regular",className:"!mt-4",color:"neutral-130",children:m.A.t("patient_common.root.account.relatives.biological_sex_subtext")})]})};var k=n(3667);const M=[{label:m.A.t("patient_mobile.root.account.new.identity_step.gender_label.female"),value:!0},{label:m.A.t("patient_mobile.root.account.new.identity_step.gender_label.male"),value:!1}],U=e=>{let{isInsEnabled:t,isLegalGenderFSEnabled:n}=e;return t?(0,A.jsx)(C,{required:!0,showSubtext:!1}):n?(0,A.jsx)(k.A,{disabled:!1,required:!0,label:""}):(0,A.jsx)("div",{className:"dl-gender-group mt-4",children:M.map((e=>(0,A.jsx)(h.A,{label:"",className:"dl-margin-y-0",field:"gender",name:"gender",type:"radio-group",options:[e],required:!0},String(e.value))))})};var F=n(11501);const D=e=>{let{state:t}=e;const[n,a]=(0,o.useState)(!1),[r,i]=(0,o.useState)(""),{refetch:s,userConversionKind:l,cp2uVersion:c}=(0,F.WL)(t.anonymousResourceType,!1);(0,o.useEffect)((()=>{t.anonymousResourceType&&s().then((e=>{var t;return i(null===(t=e.data)||void 0===t?void 0:t.creatorFirstName)})).catch((()=>{}))}),[i,s,t.anonymousResourceType]);return"master_patient_identity_mistmatch"===t.error&&(a(!0),t.error=void 0),{showDialog:n,creatorFirstName:r,dismissDialog:()=>{a(!1),t.errorData=void 0},userConversionKind:l,cp2uVersion:c}};var L=n(42724),V=n(57761),G=n(76606);const B=e=>{let{resourceType:t,source:n,userConversionKind:a,cp2uVersion:r,authenticationKind:i,showDialog:s,onHide:l,senderName:c}=e;return(0,o.useEffect)((()=>{s&&(0,G.cP)({...V.wu,details:{patient_data_synchronization_funnel_id:(0,F.nt)(t),patient_data_synchronization_kind:a,authentication_kind:i,patient_data_synchronization_not_matching_errors:[F.xv.IDENTITY],context:a,cp2u_version:r}})}),[s,n,a,r,t,i]),(0,A.jsx)(L.l,{title:m.A.t("api.accounts.index.root.anonymous_funnel.identity_mismatch.dialog.title"),show:s,onAccept:l,acceptText:m.A.t("common.got_it"),children:(0,A.jsx)(N.E,{uiStyle:"body-s-regular",block:!0,children:m.A.t("api.accounts.index.root.anonymous_funnel.identity_mismatch.dialog.description",{sender_name:c})})})},H=(0,w.G7)("ins","country"),Y=(0,w.G7)("legal_gender","country"),W=e=>{let{formApi:t,state:n,showDialog:o,creatorFirstName:a,dismissDialog:r,userConversionKind:i,cp2uVersion:s}=e;const l=(e,n)=>{(0,T.F)(n)?null===t||void 0===t||t.setError(e,m.A.t("appointments.appointment_details.invalid_char_in_name_field")):null===t||void 0===t||t.setError(e,null)};return(0,A.jsxs)("div",{children:[(0,A.jsx)(E.A,{name:"user",label:n.data.username}),(0,A.jsx)(_.o,{level:"h1",uiStyle:"title-l-bold",customStyle:["!mt-16"],children:m.A.t("patient_mobile.root.account.new.identity_step.step_title")}),(0,A.jsxs)("fieldset",{className:"mt-16",children:[(0,A.jsx)(N.E,{component:"legend",uiStyle:"body-s-bold",className:"mt-16 border-none",children:m.A.t("patient_mobile.root.account.new.identity_step.identity_label")}),(0,A.jsx)(U,{isInsEnabled:H,isLegalGenderFSEnabled:Y}),(0,A.jsx)(h.A,{id:"first_name",field:"first_name",type:"text",label:"",autoComplete:"given-name",placeholder:m.A.t("patient_mobile.root.account.new.identity_step.first_name_placeholder"),className:x()({"dl-margin-y-16":H||!Y,"dl-margin-t-4":!H&&Y}),onChange:e=>l("first_name",e),required:!0}),(0,A.jsx)(h.A,{id:"last_name",field:"last_name",type:"text",label:"",autoComplete:"family-name",placeholder:m.A.t("patient_mobile.root.account.new.identity_step.last_name_placeholder"),className:"dl-margin-y-16",onChange:e=>l("last_name",e),required:!0})]}),(0,A.jsxs)("fieldset",{children:[(0,A.jsx)(N.E,{component:"legend",uiStyle:"body-s-bold",className:"mt-16 border-none",children:m.A.t("patient_mobile.root.account.new.identity_step.birthdate_label")}),(0,A.jsx)(h.A,{id:"birthdate-2",field:"birthdate",type:"birthdate",label:"",autoComplete:"bday",placeholder:m.A.t("patient_mobile.root.account.new.identity_step.birthdate_placeholder"),className:"dl-margin-t-4 dl-margin-b-0",options:{minAge:f.Ay.ACCOUNT_MIN_LEGAL_AGE,minAgeErrorMessage:m.A.t("accounts.age_too_young",{min_age:f.Ay.ACCOUNT_MIN_LEGAL_AGE})},hideInputDetails:!0,hideRequiredIndicator:!0,required:!0})]}),n.anonymousResourceType&&(0,A.jsx)(B,{senderName:null!==a&&void 0!==a?a:"",userConversionKind:i,cp2uVersion:s,authenticationKind:n.isNewUser?p.W.SIGNUP:p.W.LOGIN,source:void 0,resourceType:n.anonymousResourceType,showDialog:o,onHide:r})]})},K=e=>{let{formApi:t,state:n}=e;const{showDialog:o,dismissDialog:a,creatorFirstName:r,userConversionKind:i,cp2uVersion:s}=D({state:n});return(0,A.jsx)(W,{formApi:t,state:n,showDialog:o,dismissDialog:a,creatorFirstName:r,userConversionKind:i,cp2uVersion:s})},q=e=>{let{state:t,formApi:n}=e;const[a,r]=(0,o.useState)(null),i=(0,o.useRef)();return(0,o.useEffect)((()=>{var e;return r(null!==(e=t.error)&&void 0!==e?e:null)}),[t.error,null===n||void 0===n?void 0:n.submits]),(0,o.useEffect)((()=>{t.showModal||setTimeout((()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.focus()}),500)}),[t.showModal]),(0,A.jsxs)("div",{children:[(0,A.jsx)(E.A,{name:"envelope"}),(0,A.jsx)(_.o,{level:"h1",uiStyle:"title-l-bold",customStyle:["!mt-16"],children:m.A.t("appointments.login_or_signup.verify_email_step.label")}),(0,A.jsx)(h.A,{className:"!mt-16 !mb-0",ref:i,id:"email",field:"email",label:"",type:"email",error:Boolean(a),placeholder:m.A.t("appointments.login_or_signup.verify_email_step.placeholder"),required:!0}),a&&(0,A.jsx)(y.A,{uiStyle:"body-xs-regular",color:"error-090","aria-live":"polite",children:a})]})};var z=n(43486);const J=()=>{const e=(0,o.useRef)();return(0,o.useEffect)((()=>{setTimeout((()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.focus()}),500)}),[]),(0,A.jsxs)("div",{children:[(0,A.jsx)(E.A,{name:"lock"}),(0,A.jsx)(_.o,{level:"h1",uiStyle:"title-l-bold",customStyle:["!mt-16"],children:m.A.t("patient_mobile.root.account.new.password_step.input_label")}),(0,A.jsx)(z.A,{className:"!mt-16 !mb-0",ref:e,noEmptyHint:!0,showIcon:!1,id:"password",field:"password",placeholder:m.A.t("patient_mobile.root.account.new.password_step.input_placeholder"),label:"",required:!0})]})};var $=n(4882),Z=n(34294),Q=n(72371),X=n(14688),ee=n(38898),te=n(66481),ne=n(85511),oe=n(69447);const ae=n.p+"2a910d57e006d01e8582.png",re=e=>{let{termsCheckboxValue:t,onChange:n,legalTermAcceptance:o}=e;const a=t&&1===t.length&&"checked"===t[0],r=(0,s.A)(t)&&!1===o||!!t&&!a;return(0,A.jsx)(O.F,{horizontal:!1,type:"checkbox",name:"terms_and_conditions","aria-labelledby":"terms_and_conditions",onSelect:n,state:r?"error":void 0,message:r?m.A.t("patient_mobile.root.account.new.privacy_policy_step.error_message"):void 0,options:[{label:m.A.t("patient_mobile.root.account.new.privacy_policy_step.terms_and_conditions.label"),value:"checked"}],value:null!==t&&void 0!==t?t:[]})},ie=e=>{let{error:t,errorIsFromCaptcha:n}=e;const[a,r]=(0,o.useState)(!1),[i,s]=(0,o.useState)(0);return(0,o.useEffect)((()=>{n&&s((e=>e+1))}),[t,n]),(0,o.useEffect)((()=>{t&&r(!(n&&i<=1))}),[t,n,i]),(0,A.jsxs)(Q.A,{size:"small",show:a,onHide:()=>r(!1),children:[(0,A.jsxs)(X.c,{alignText:"left",children:[(0,A.jsx)(N.E,{component:"div",uiStyle:"body-s-bold",className:"mb-16",children:m.A.t("common.account_not_created")}),(0,A.jsx)(N.E,{component:"div",uiStyle:"body-s-regular",className:"mb-16",children:t},t)]}),(0,A.jsx)(ee.j,{className:"flex flex-col",children:(0,A.jsx)(Z.$,{onClick:()=>r(!1),children:m.A.t("common.got_it")})})]})},se=e=>{let{state:{error:t,errorData:n,legalTermAcceptance:a,funnelId:r,anonymousResourceType:i}}=e;const s=(0,P.WZ)(),[l,c]=(0,o.useState)(null),{userConversionKind:u,isError:d}=(0,F.WL)(i);return(0,A.jsxs)("div",{children:[(0,A.jsx)(te._,{className:"h-64",src:ae,alt:""}),(0,A.jsx)(_.o,{level:"h1",uiStyle:"title-s-bold",customStyle:["!mt-16"],children:m.A.t("patient_mobile.root.account.new.privacy_policy_step.title")}),(0,A.jsx)(N.E,{component:"p",id:"terms_and_conditions",uiStyle:"body-s-regular",className:"!mt-8",children:m.A.t("patient_mobile.root.account.new.privacy_policy_step.body_html",{url:f.Ay.PATIENT_LEGAL_INFO_LINKS.terms_and_conditions})}),(0,A.jsx)("div",{className:"mt-16",children:(0,A.jsx)(re,{legalTermAcceptance:a,termsCheckboxValue:l,onChange:e=>{const t=1===e.length&&"checked"===e[0];c(e),s.setValue("terms_and_conditions",t),t&&!d&&(0,oe.Ay)({name:"patient_signup_accept_terms",details:{funnel_id:r,kind:u,source:i}},{schema:"patient"})}})}),(null===n||void 0===n?void 0:n.captcha_required)&&(0,A.jsx)(ne.SE,{}),(0,A.jsx)(N.E,{component:"p",uiStyle:"body-s-regular",color:"neutral-090",className:"!mt-16",children:m.A.t("patient_mobile.root.account.new.privacy_policy_step.data_protection.further_information_html",{url:f.Ay.PATIENT_LEGAL_INFO_LINKS.privacy_policy})}),(0,A.jsx)(ie,{error:t,errorIsFromCaptcha:null===n||void 0===n?void 0:n.captcha_required})]})};var le=n(96005),ce=n(13958);const ue=e=>{let{state:t,formApi:n}=e;const[r,i]=(0,o.useState)(null),s=(0,a.useNavigate)(),l=(0,v.gf)((0,g.JJ)(),null===n||void 0===n?void 0:n.values.username)?"tel":"email",c="tel"===l?m.A.t("appointments.login_or_signup.signin.placeholder_phone_number"):m.A.t("appointments.login_or_signup.signin.placeholder_email");return(0,o.useEffect)((()=>{var e;return i(null!==(e=t.error)&&void 0!==e?e:null)}),[t.error,null===n||void 0===n?void 0:n.submits]),(0,A.jsxs)("div",{children:[(0,A.jsx)(E.A,{name:"lock"}),(0,A.jsx)(_.o,{level:"h1",uiStyle:"title-l-bold",customStyle:["!mt-16"],children:m.A.t("appointments.login_or_signup.signin.password_title")}),(0,A.jsx)(h.A,{className:"!mt-16 !mb-0",id:"username",field:"username",label:"",type:l,placeholder:c,required:!0,readOnly:!0}),(0,A.jsx)(h.A,{className:"!mt-16 !mb-0",id:"password",field:"password",label:"",type:"password",placeholder:m.A.t("appointments.login_or_signup.signin.password"),error:Boolean(r),validate:e=>(0,ce.A)(e),onChange:()=>i(null),focus:!0}),r&&(0,A.jsx)(y.A,{uiStyle:"body-xs-regular",color:"error-090","aria-live":"polite",children:r}),(0,A.jsx)(le.A,{labelClassName:"!mt-8",field:"remember_username",label:m.A.t("appointments.login_or_signup.signin.remember_username")}),(0,A.jsx)(Z.$,{className:"mb-24",component:"a",uiStyle:"link-primary",onClick:()=>{(0,oe.Ay)({name:"patient_signin_password_forgotten"},{schema:"patient"}),(0,G.cP)({...V.VW,details:{context:t.context}}),s("/account/passwords/new?context=".concat(t.context),{state:{username:null===n||void 0===n?void 0:n.values.username}})},children:m.A.t("common.password_reset.title")})]})};var de=n(57713);const me=e=>{let{onStepSubmit:t,state:{anonymousResourceType:n,cp2uVersion:o,context:r},title:i}=e;const s=(0,g.G9)(),l=(0,g.kT)(),{state:c}=(0,a.useLocation)();return(0,A.jsxs)("div",{"data-test":"authentication-choice",children:[s&&(0,A.jsx)("div",{className:"mb-16 text-center",children:(0,A.jsx)(_.o,{level:"h1",uiStyle:"title-s-bold",children:i})}),(0,A.jsx)(de.Z,{className:x()({"!p-0":l}),children:(0,A.jsxs)("div",{className:"flex flex-col items-center text-center gap-8",children:[(0,A.jsx)(_.o,{level:"h2",uiStyle:"title-s-bold",children:m.A.t("appointments.login_or_signup.new_on_doctolib")}),(0,A.jsx)(Z.$,{type:"button",onClick:()=>{(0,G.cP)({...V.t3,details:{context:r,cp2u_version:o}}),t({isNewUser:!0})},className:"w-[310px]",children:m.A.t("appointments.login_or_signup.authentication_choice_step.sign_up.button_text")})]})}),(0,A.jsx)(de.Z,{className:x()({"mt-16 z-10":s}),children:(0,A.jsxs)("div",{className:"flex flex-col items-center text-center gap-8",children:[(0,A.jsx)(_.o,{level:"h2",uiStyle:"title-s-bold",children:m.A.t("appointments.login_or_signup.ever_used_doctolib")}),(0,A.jsx)(Z.$,{type:"button",uiStyle:"DEPRECATED_yellow",onClick:()=>{(0,G.cP)({...V.gZ,details:{context:r,cp2u_version:o}}),t({isNewUser:!1})},className:"w-[310px]",children:m.A.t("appointments.login_or_signup.authentication_choice_step.sign_in.button_text")})]})}),n===F.OO.APPOINTMENT&&!(null!==c&&void 0!==c&&c.hideContinueWithoutAccount)&&(0,A.jsx)("div",{className:"mt-16 text-center",children:(0,A.jsx)(Z.$,{type:"button",uiStyle:"tertiary-neutral",onClick:()=>{t({isNewUser:void 0})},children:m.A.t("appointments.login_or_signup.authentication_choice_step.continue_without_account.button_text")})}),(0,g.Tq)()&&(0,A.jsxs)("div",{className:"flex flex-wrap dl-flex-grow-shrink-auto dl-align-items-center justify-center mb-24 bottom-0 left-0 right-0 dl-footer-div ".concat(l?"absolute bottom-24":""),children:[(0,A.jsx)(N.E,{uiStyle:"body-s-regular",children:m.A.t("appointments.login_or_signup.authentication_choice_step.powered_by")}),(0,A.jsx)("div",{className:"logo-doctolib real-logo-doctolib-for-portal-blue ml-8"})]})]})};var pe=n(31330);const _e=e=>{let{email:t,source:n,userConversionKind:a,cp2uVersion:r,authenticationKind:i,showDialog:s,createdByRelative:l,creatorFirstName:c,resourceType:u,onHide:d}=e;(0,o.useEffect)((()=>{s&&(0,G.cP)({...V.wu,details:{patient_data_synchronization_funnel_id:(0,F.nt)(u),patient_data_synchronization_kind:a,authentication_kind:i,patient_data_synchronization_not_matching_errors:[F.xv.EMAIL],context:a,cp2u_version:r}})}),[s,n,a,r,u,i]);const p=u===F.OO.APPOINTMENT?m.A.t("api.accounts.index.root.anonymous_funnel.cr2u_eligible.appointment_confirm_email_alert",{first_name:c}):m.A.t("api.accounts.index.root.anonymous_funnel.cr2u_eligible.confirm_email_alert",{first_name:c}),_=l?p:m.A.t("api.accounts.index.root.anonymous_funnel.eligible.confirm_email_alert"),h=l?m.A.t("api.accounts.index.root.anonymous_funnel.cr2u_contact_info_mismatch.email.spelling_error_tip",{first_name:c}):m.A.t("api.accounts.index.root.anonymous_funnel.contact_info_mismatch.email_mismatch.spelling_error_tip");return(0,A.jsxs)(L.l,{title:m.A.t("api.accounts.index.root.anonymous_funnel.contact_info_mismatch.email_mismatch.title"),show:s,onAccept:d,acceptText:m.A.t("common.got_it"),children:[(0,A.jsx)(N.E,{uiStyle:"body-s-regular",block:!0,children:_}),(0,A.jsx)(N.E,{uiStyle:"body-s-bold",block:!0,className:"!mb-16",children:t}),(0,A.jsx)(N.E,{uiStyle:"body-s-regular",block:!0,children:h})]})},he=e=>{let{state:t}=e;const{email:n,isError:a,error:r}=(0,F.WL)(t.anonymousResourceType),[i,s]=(0,o.useState)(!1),l=(0,pe.Ay)();return"email_mismatch"===t.error&&(s(!0),t.error=void 0),(0,o.useEffect)((()=>{a&&(s(!0),l({message:m.A.t("common.error"),uiStyle:"error"}))}),[a,r,l]),{email:n,showDialog:i,dismissDialog:()=>{s(!1)}}};var ve=n(5018);const ge=e=>{let{resourceType:t,email:n,createdByRelative:o,creatorFirstName:a}=e;const r=t===F.OO.APPOINTMENT?m.A.t("api.accounts.index.root.anonymous_funnel.cr2u_eligible.appointment_confirm_email_alert",{first_name:a}):m.A.t("api.accounts.index.root.anonymous_funnel.cr2u_eligible.confirm_email_alert",{first_name:a}),i=o?r:m.A.t("api.accounts.index.root.anonymous_funnel.eligible.confirm_email_alert");return(0,A.jsx)(ve.F,{variant:"deprecated-alert-interface",size:"medium",className:"!p-8 mt-16",children:(0,A.jsxs)(N.E,{uiStyle:"body-s-regular",block:!0,children:[i,n]})})},ye=e=>{let{state:t,formApi:n,email:o,createdByRelative:a,creatorFirstName:r}=e;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(b,{state:t,formApi:n,label:"common.mail_confirm",placeholder:m.A.t("appointments.login_or_signup.verify_email_step.placeholder")}),o&&o.length&&(0,A.jsx)(ge,{resourceType:t.anonymousResourceType,email:o,creatorFirstName:r,createdByRelative:a})]})},Ee=e=>{let{state:t,formApi:n}=e;const{email:a,showDialog:r,dismissDialog:i}=he({state:t}),{anonymousResourceType:s}=t,{creatorFirstName:l,createdByRelative:c,userConversionKind:u,cp2uVersion:d,isError:_,error:h}=(0,F.WL)(s),v=(0,pe.Ay)();return(0,o.useEffect)((()=>{_&&v({message:m.A.t("common.error"),uiStyle:"error"})}),[_,h,v,i]),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(_e,{email:a,source:s,userConversionKind:u,cp2uVersion:d,authenticationKind:t.isNewUser?p.W.SIGNUP:p.W.LOGIN,showDialog:r,onHide:i,creatorFirstName:l,createdByRelative:c,resourceType:s}),(0,A.jsx)(ye,{state:t,formApi:n,email:a,creatorFirstName:l,createdByRelative:c})]})},Ae=e=>{let{phone_number:t,source:n,userConversionKind:a,cp2uVersion:r,authenticationKind:i,showDialog:s,createdByRelative:l,creatorFirstName:c,resourceType:u,onHide:d}=e;(0,o.useEffect)((()=>{s&&(0,G.cP)({...V.wu,details:{patient_data_synchronization_funnel_id:(0,F.nt)(u),patient_data_synchronization_kind:a,authentication_kind:i,patient_data_synchronization_not_matching_errors:[F.xv.PHONE],context:a,cp2u_version:r}})}),[n,a,r,s,u,i]);const p=l?m.A.t("api.accounts.index.root.anonymous_funnel.cr2u_eligible.confirm_phone_number_alert",{first_name:c}):m.A.t("api.accounts.index.root.anonymous_funnel.eligible.confirm_phone_number_alert"),_=l?m.A.t("api.accounts.index.root.anonymous_funnel.cr2u_contact_info_mismatch.phone.spelling_error_tip",{first_name:c}):m.A.t("api.accounts.index.root.anonymous_funnel.contact_info_mismatch.phone_mismatch.spelling_error_tip");return(0,A.jsxs)(L.l,{title:m.A.t("api.accounts.index.root.anonymous_funnel.contact_info_mismatch.phone_mismatch.title"),show:s,onAccept:d,acceptText:m.A.t("common.got_it"),children:[(0,A.jsx)(N.E,{uiStyle:"body-s-regular",block:!0,children:p}),(0,A.jsx)(N.E,{uiStyle:"body-s-bold",block:!0,className:"!mb-16",children:t}),(0,A.jsx)(N.E,{uiStyle:"body-s-regular",block:!0,children:_})]})},be=e=>{let{state:t}=e;const{phoneNumber:n,isError:a,error:r}=(0,F.WL)(t.anonymousResourceType),[i,s]=(0,o.useState)(!1),l=(0,pe.Ay)();return(0,o.useEffect)((()=>{a&&(s(!0),l({message:m.A.t("common.error"),uiStyle:"error"}))}),[a,r,l]),"phone_mismatch"===t.error&&(s(!0),t.error=void 0),{phoneNumber:n,showDialog:i,dismissDialog:()=>{s(!1)}}},fe=e=>{let{phone_number:t,createdByRelative:n,creatorFirstName:o}=e;const a=n?m.A.t("api.accounts.index.root.anonymous_funnel.cr2u_eligible.confirm_phone_number_alert",{first_name:o}):m.A.t("api.accounts.index.root.anonymous_funnel.eligible.confirm_phone_number_alert");return(0,A.jsx)(ve.F,{variant:"deprecated-alert-interface",size:"small",className:"mt-16",children:(0,A.jsxs)(N.E,{uiStyle:"body-s-regular",block:!0,children:[a,t]})})},Ne=e=>{let{formApi:t,phone_number:n,createdByRelative:o,creatorFirstName:a}=e;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)($.A,{formApi:t}),(0,A.jsx)(fe,{phone_number:n,creatorFirstName:a,createdByRelative:o})]})},Se=e=>{let{state:t,formApi:n}=e;const{phoneNumber:a,showDialog:r,dismissDialog:i}=be({state:t}),{creatorFirstName:s,createdByRelative:l,userConversionKind:c,cp2uVersion:u,isError:d,error:_}=(0,F.WL)(t.anonymousResourceType),h=(0,pe.Ay)();return(0,o.useEffect)((()=>{d&&(i(),h({message:m.A.t("common.error"),uiStyle:"error"}))}),[i,d,_,h]),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(Ae,{phone_number:a,source:t.anonymousResourceType,userConversionKind:c,cp2uVersion:u,authenticationKind:t.isNewUser?p.W.SIGNUP:p.W.LOGIN,showDialog:r,createdByRelative:l,creatorFirstName:s,onHide:i,resourceType:t.anonymousResourceType}),(0,A.jsx)(Ne,{formApi:n,phone_number:a,createdByRelative:l,creatorFirstName:s})]})},xe=e=>{let{state:t,formApi:n}=e;const[r,i]=(0,o.useState)(null),s=(0,a.useNavigate)(),l=(0,v.gf)((0,g.JJ)(),null===n||void 0===n?void 0:n.values.username)?"tel":"email",c="tel"===l?m.A.t("appointments.login_or_signup.signin.placeholder_phone_number"):m.A.t("appointments.login_or_signup.signin.placeholder_email");return(0,o.useEffect)((()=>{var e;return i(null!==(e=t.error)&&void 0!==e?e:null)}),[t.error,null===n||void 0===n?void 0:n.submits]),(0,A.jsxs)("div",{children:[(0,A.jsx)(E.A,{name:"lock"}),(0,A.jsx)(_.o,{level:"h1",uiStyle:"title-l-bold",customStyle:["!mt-16"],children:m.A.t("appointments.login_or_signup.signin.password_title")}),(0,A.jsx)(h.A,{className:"!mt-16 !mb-0",id:"username",field:"username",label:"",type:l,placeholder:c,required:!0,readOnly:!0}),(0,A.jsx)(h.A,{className:"!mt-16 !mb-0",id:"password",field:"password",label:"",type:"password",placeholder:m.A.t("appointments.login_or_signup.signin.password"),error:Boolean(r),validate:e=>(0,ce.A)(e),onChange:()=>i(null),focus:!0}),r&&(0,A.jsx)(y.A,{uiStyle:"body-xs-regular",color:"error-090","aria-live":"polite",children:r}),(0,A.jsx)(le.A,{labelClassName:"!mt-8",field:"remember_username",label:m.A.t("appointments.login_or_signup.signin.remember_username")}),(0,A.jsx)(Z.$,{className:"mb-24",component:"a",uiStyle:"link-primary",onClick:()=>{(0,oe.Ay)({name:"patient_signin_password_forgotten"},{schema:"patient"}),(0,G.cP)({...V.VW,details:{context:t.context}}),s("/account/passwords/new?context=".concat(t.context),{state:{username:null===n||void 0===n?void 0:n.values.username}})},children:m.A.t("common.password_reset.title")})]})},Te={component:me,path:p.a.AUTHENTICATION_CHOICE_STEP,title:m.A.t("patient_mobile.root.account.new.titles.identification"),trackingName:"patient_authentication_choice",productEvent:V.WZ},we={component:b,path:p.a.USERNAME_SIGN_UP_STEP,title:m.A.t("patient_mobile.root.account.new.titles.register"),trackingName:"patient_signup_username"},Ie={component:b,path:p.a.USERNAME_SIGN_IN_STEP,title:m.A.t("patient_mobile.root.account.new.titles.login"),trackingName:"patient_signin_username",productEvent:V.mi,onSubmitProductEvent:V.Jn},Pe={component:Ee,path:p.a.ANONYMOUS_RESOURCE_SIGN_IN_STEP,title:m.A.t("patient_mobile.root.account.new.titles.login"),trackingName:"patient_signin_username",productEvent:V.mi,onSubmitProductEvent:V.Jn},Re={component:K,path:p.a.IDENTITY_STEP,title:m.A.t("patient_mobile.root.account.new.titles.register"),trackingName:"patient_signup_identity",productEvent:V.cJ},Oe={component:q,path:p.a.VERIFY_EMAIL_STEP,title:m.A.t("patient_mobile.root.account.new.titles.register"),trackingName:"patient_signup_mail"},je={component:Ee,path:p.a.ANONYMOUS_RESOURCE_VERIFY_EMAIL_STEP,title:m.A.t("patient_mobile.root.account.new.titles.register"),trackingName:"patient_signup_username"},Ce={component:J,path:p.a.PASSWORD_STEP,title:m.A.t("patient_mobile.root.account.new.titles.register"),trackingName:"patient_signup_password"},ke={component:$.A,path:p.a.VERIFY_PHONE_NUMBER_STEP,title:m.A.t("patient_mobile.root.account.new.titles.register"),trackingName:"patient_signup_phone"},Me={component:Se,path:p.a.ANONYMOUS_RESOURCE_VERIFY_PHONE_NUMBER_STEP,title:m.A.t("patient_mobile.root.account.new.titles.register"),trackingName:"patient_signup_phone"},Ue={component:se,path:p.a.LEGAL_TERMS_STEP,title:m.A.t("patient_mobile.root.account.new.titles.register"),trackingName:"patient_signup_terms_privacy"},Fe={component:ue,path:p.a.LOGIN_STEP,title:m.A.t("patient_mobile.root.account.new.titles.login"),trackingName:"patient_signin_page",productEvent:V.sS,onSubmitProductEvent:V.KB},De={component:xe,path:p.a.ANONYMOUS_RESOURCE_LOGIN_STEP,title:m.A.t("patient_mobile.root.account.new.titles.login"),trackingName:"patient_signin_page",productEvent:V.sS,onSubmitProductEvent:V.KB},Le={component:null,path:p.a.VERIFICATION_CODE_STEP,title:"",trackingName:""},Ve={component:null,path:p.a.MARKETING_OPT_IN_STEP,title:"",trackingName:""};var Ge=n(78496),Be=n(18227),He=n(73443);const Ye=[Te,we,Ie,Re,Oe,Ce,ke,Ue,Fe,Ve],We=[Te,Pe,Re,je,Me,Ce,Ue,De,Ve],Ke=[Ue,Ve,Le,Fe],qe={anonymousResource:{signUp:[Te,je,Re,Ce,Me],signIn:[Te,Pe,De]},standard:{signUp:{phoneNumber:[Te,we,Re,Oe,Ce],email:[Te,we,Re,Ce,ke]},signIn:[Te,Ie,Fe]}},ze=e=>{let{isNewUser:t,isPhoneNumberFlow:n,isAnonymousFunnel:o,anonymousResourceType:a}=e;const{anonymousResource:r,standard:i}=qe;if(t){if(o)return[...r.signUp,...Ke];return[...n?i.signUp.phoneNumber:i.signUp.email,...Ke]}return o&&a?r.signIn:i.signIn},Je=e=>{let{isAnonymousFunnel:t,isNewUser:n,isPhoneNumberFlow:o,anonymousResourceType:a}=e;const r=ze({isAnonymousFunnel:t,isNewUser:n,isPhoneNumberFlow:o,anonymousResourceType:a});let i=Ye;return t&&a&&(i=We),{steps:r,stepsForRoutes:i}},$e=e=>{let{name:t,appointmentId:n,inBooking:o,profileId:a,funnelId:r,details:i,customDetails:s}=e;(0,oe.Ay)({name:t,details:{appointment_id:n,out_of_booking:!o,profile_id:a,funnel_id:r,...i,...s}},{schema:"patient"})},Ze=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null!==e&&void 0!==e&&e.name&&(0,G.cP)({...e,details:t})};var Qe=n(64422),Xe=n(29762),et=n(99178);const tt=(e,t)=>{var n;if(!t||!t.length)return p.a.AUTHENTICATION_CHOICE_STEP;const o=t.findIndex((t=>t.path===e));return o<0?p.a.AUTHENTICATION_CHOICE_STEP:null===(n=t[o+1])||void 0===n?void 0:n.path},nt=(e,t)=>t?{phone_number:e}:{email:e},ot=e=>e?"phone":"email",at=e=>e?"username_already_exists":"unknown_username",rt={[p.a.AUTHENTICATION_CHOICE_STEP]:async e=>{let{values:{isNewUser:t},state:n}=e;const o=ze({...n,isNewUser:t}),a=tt(p.a.AUTHENTICATION_CHOICE_STEP,o);let r,i=t?"signup":"signin";if(void 0===t){i="skip";r=(e=>{let{resourceId:t,resourceType:n}=e;if(t)return n===F.OO.APPOINTMENT?(0,g.G9)()?"/appointments/anonymous/".concat(t):"/appointments/anonymous/list":void 0})({resourceType:n.anonymousResourceType,resourceId:n.anonymousResourceId})}return{nextStepPath:a,stateInfo:{isNewUser:t},submitTrackingDetails:{type:i},redirect:r}},[p.a.USERNAME_SIGN_IN_STEP]:async e=>{let{values:t}=e;return(async(e,t)=>{l.hZ("last-used-username",e);const{error:n,account_exists:o}=await Ge.A.account.checkExistence(e).catch((e=>({error:e})));var a,r;if(n)return{error:(0,Xe.I)({error:null===(a=n.response)||void 0===a||null===(a=a.bodyData)||void 0===a?void 0:a.error,status:null===(r=n.response)||void 0===r?void 0:r.status})};const i=!o,s=/^\+*[0-9. ]*$/.test(e),c={isNewUser:i,isPhoneNumberFlow:s,data:{username:e}};return o?t:{nextStepPath:p.a.IDENTITY_STEP,stateInfo:c,showModal:{reason:at(o),data:{value:e,usernameType:ot(s)}}}})(t.username,{nextStepPath:p.a.LOGIN_STEP})},[p.a.USERNAME_SIGN_UP_STEP]:async e=>{let{values:t,state:n}=e;return(async e=>{let{currentStepPath:t,values:n,state:o}=e;const a=n.username;l.hZ("last-used-username",a);const{error:r,account_exists:i}=await Ge.A.account.checkExistence(a).catch((e=>({error:e})));var s,c;if(r)return{error:(0,Xe.I)({error:null===(s=r.response)||void 0===s||null===(s=s.bodyData)||void 0===s?void 0:s.error,status:null===(c=r.response)||void 0===c?void 0:c.status})};const u=!i,d=/^\+*[0-9. ]*$/.test(a),m=ze({...o,isNewUser:u,isPhoneNumberFlow:d});if(i){const e={isNewUser:u,isPhoneNumberFlow:d,data:{username:a}};return{nextStepPath:p.a.LOGIN_STEP,stateInfo:e,showModal:{reason:at(i),data:{value:a,usernameType:ot(d)}}}}return{nextStepPath:tt(t,m),stateInfo:{isNewUser:u,isPhoneNumberFlow:d}}})({currentStepPath:p.a.USERNAME_SIGN_UP_STEP,values:t,state:n})},[p.a.ANONYMOUS_RESOURCE_SIGN_IN_STEP]:async e=>{let{values:t,state:n}=e;const o=t.username,a=n.anonymousResourceType,{creator_match:r,email_match:i}=await Ge.A.anonymousResource.verifyPatientData({resourceType:a,email:o});if(!i&&!r)return{error:"email_mismatch"};const{error:s,account_exists:l}=await Ge.A.account.checkExistence(o).catch((e=>({error:e})));var c,u;if(s)return{error:(0,Xe.I)({error:null===(c=s.response)||void 0===c||null===(c=c.bodyData)||void 0===c?void 0:c.error,status:null===(u=s.response)||void 0===u?void 0:u.status})};const d=!l,m=/^\+*[0-9. ]*$/.test(o),_={isNewUser:d,isPhoneNumberFlow:m,data:{username:o}};return l?{nextStepPath:p.a.ANONYMOUS_RESOURCE_LOGIN_STEP}:{nextStepPath:p.a.IDENTITY_STEP,stateInfo:_,showModal:{reason:at(l),data:{value:o,usernameType:ot(m)}}}},[p.a.IDENTITY_STEP]:async e=>{var t;let{steps:n,state:o,values:a}=e;const{first_name:r,last_name:i,birthdate:s}=a,l={resourceType:o.anonymousResourceType,firstName:r,lastName:i,birthdate:s},c=Ge.A.anonymousResource.verifyPatientData,{cr2u:u}=await c(l);return!u||null!==(t=u.identity)&&void 0!==t&&t.master_patient_identity_match?{nextStepPath:tt(p.a.IDENTITY_STEP,n)}:{error:"master_patient_identity_mistmatch",errorData:{cr2u:u}}},[p.a.VERIFY_EMAIL_STEP]:async e=>{let{values:{email:t},steps:n}=e;return(async e=>{let{currentStepPath:t,values:{email:n},steps:o}=e;l.hZ("last-used-username",n);const{error:a,account_exists:r}=await Ge.A.account.checkExistence(n).catch((e=>({error:e})));var i,s;if(a)return{error:(0,Xe.I)({error:null===(i=a.response)||void 0===i||null===(i=i.bodyData)||void 0===i?void 0:i.error,status:null===(s=a.response)||void 0===s?void 0:s.status})};if(r){const e={isNewUser:!1,isPhoneNumberFlow:!1,data:{username:n}};return{nextStepPath:p.a.LOGIN_STEP,stateInfo:e,showModal:{reason:"username_already_exists",data:{value:n,usernameType:"email"}}}}return{nextStepPath:tt(t,o)}})({currentStepPath:p.a.VERIFY_EMAIL_STEP,values:{email:t},steps:n})},[p.a.ANONYMOUS_RESOURCE_VERIFY_EMAIL_STEP]:async e=>{let{values:{username:t},steps:n,state:o}=e;const a=o.anonymousResourceType,{email_match:r}=await Ge.A.anonymousResource.verifyPatientData({resourceType:a,email:t});if(!r)return{error:"email_mismatch"};const{error:i,account_exists:s}=await Ge.A.account.checkExistence(t).catch((e=>({error:e})));var l,c;if(i)return{error:(0,Xe.I)({error:null===(l=i.response)||void 0===l||null===(l=l.bodyData)||void 0===l?void 0:l.error,status:null===(c=i.response)||void 0===c?void 0:c.status})};if(s){const e={isNewUser:!1,isPhoneNumberFlow:!1,data:{username:t}};return{nextStepPath:p.a.ANONYMOUS_RESOURCE_LOGIN_STEP,stateInfo:e,showModal:{reason:"username_already_exists",data:{value:t,usernameType:"email"}}}}return{nextStepPath:tt(p.a.ANONYMOUS_RESOURCE_VERIFY_EMAIL_STEP,n)}},[p.a.PASSWORD_STEP]:async e=>{let{steps:t}=e;return{nextStepPath:tt(p.a.PASSWORD_STEP,t)}},[p.a.VERIFY_PHONE_NUMBER_STEP]:async e=>{let{values:{phone_number:t},steps:n}=e;return(async e=>{let{currentStepPath:t,values:{phone_number:n},steps:o}=e;l.hZ("last-used-username",n);const{error:a,account_exists:r}=await Ge.A.account.checkExistence(n).catch((e=>({error:e})));var i,s;if(a)return{error:(0,Xe.I)({error:null===(i=a.response)||void 0===i||null===(i=i.bodyData)||void 0===i?void 0:i.error,status:null===(s=a.response)||void 0===s?void 0:s.status})};if(r){const e={isNewUser:!1,isPhoneNumberFlow:!0,data:{username:n}};return{nextStepPath:p.a.LOGIN_STEP,stateInfo:e,showModal:{reason:"username_already_exists",data:{value:n,usernameType:"phone"}}}}return{nextStepPath:tt(t,o)}})({currentStepPath:p.a.VERIFY_PHONE_NUMBER_STEP,values:{phone_number:t},steps:n})},[p.a.ANONYMOUS_RESOURCE_VERIFY_PHONE_NUMBER_STEP]:async e=>{let{values:{phone_number:t},steps:n,state:o}=e;const a=o.anonymousResourceType,{phone_match:r}=await Ge.A.anonymousResource.verifyPatientData({resourceType:a,phoneNumber:t});if(!r)return{error:"phone_mismatch"};const{error:i,account_exists:s}=await Ge.A.account.checkExistence(t).catch((e=>({error:e})));var l,c;if(i)return{error:(0,Xe.I)({error:null===(l=i.response)||void 0===l||null===(l=l.bodyData)||void 0===l?void 0:l.error,status:null===(c=i.response)||void 0===c?void 0:c.status})};if(s){const e={isNewUser:!1,isPhoneNumberFlow:!0,data:{username:t}};return{nextStepPath:p.a.ANONYMOUS_RESOURCE_LOGIN_STEP,stateInfo:e,showModal:{reason:"username_already_exists",data:{value:t,usernameType:"phone"}}}}return{nextStepPath:tt(p.a.ANONYMOUS_RESOURCE_VERIFY_PHONE_NUMBER_STEP,n)}},[p.a.LEGAL_TERMS_STEP]:async e=>{let{values:t,state:{isPhoneNumberFlow:n,tankerContext:o,login:a,anonymousResourceType:i,cp2uVersion:s,context:l},steps:c}=e;if(!0!==t.terms_and_conditions)return{error:"",stateInfo:{legalTermAcceptance:!1}};const u=t.username,d=t[ne.uN],_={...(0,r.A)(t,[ne.uN]),...nt(u,n)},{error:h,...v}=await Ge.A.account.signup({...d?{[ne.uN]:d}:{},account:_,anonymous_resource_type:i}).then((e=>((0,G.cP)({...V.p_,details:{context:l,authentication_kind:"signup",cp2u_version:s}}),(0,G.aP)({schema:"websites",name:"marketing_pages_conversion__signup_authentication__succeeded",funnel_name:"marketing_pages_conversion",team:"LEAP"}),e))).catch((e=>({error:e})));var g,y;if(h)return{error:(null===(g=h.response)||void 0===g||null===(g=g.bodyData)||void 0===g?void 0:g.error)||m.A.t("patient_mobile.root.account.new.generic_error"),errorData:null===(y=h.response)||void 0===y?void 0:y.bodyData};await(0,et._)({tankerContext:o,login:a},v,_);const E=c.findIndex((e=>e.path===p.a.LEGAL_TERMS_STEP)),A=new URL(window.location.href).searchParams,b=new URLSearchParams(A.toString());return b.append("current_step","".concat(E+1)),b.append("total_steps","".concat(c.length)),{redirect:"".concat(v.redirection,"?").concat(b.toString())}},[p.a.LOGIN_STEP]:async e=>{let{values:{username:t,password:n,remember_username:o},state:a}=e;const{error:r,redirection:i,refresh_token:s,...l}=await Ge.A.login({username:t,password:n,redirection:a.redirection}).then((e=>(e.two_factor_auth_response||(0,G.cP)({...V.qh,details:{context:a.context,authentication_kind:"login"}}),e))).catch((e=>({error:e})));if(r){var c,u;const e={error:null===(c=r.response)||void 0===c||null===(c=c.bodyData)||void 0===c?void 0:c.error,status:null===(u=r.response)||void 0===u?void 0:u.status};return e.error===Qe.A.PasswordExpired&&401===e.status?{showModal:{reason:"password_expired"}}:{error:(0,Xe.I)(e)}}return await(0,et.l)(a.tankerContext,l,{username:t,password:n,remember_username:o,refresh_token:s}),{redirect:i}},[p.a.ANONYMOUS_RESOURCE_LOGIN_STEP]:async e=>{let{values:{username:t,password:n,remember_username:o},state:a}=e,r=a.redirection;const i=a.anonymousResourceType,s=a.anonymousResourceId;s&&i&&!r&&(r="/anonymous/resource/".concat(i,"/").concat(s));const{error:l,redirection:c,refresh_token:u,...d}=await Ge.A.login({username:t,password:n,redirection:r}).then((e=>(e.two_factor_auth_response||(0,G.cP)({...V.qh,details:{context:a.context,authentication_kind:"login"}}),e))).catch((e=>({error:e})));if(l){var m,p;const e={error:null===(m=l.response)||void 0===m||null===(m=m.bodyData)||void 0===m?void 0:m.error,status:null===(p=l.response)||void 0===p?void 0:p.status};return e.error===Qe.A.PasswordExpired&&401===e.status?{showModal:{reason:"password_expired"}}:{error:(0,Xe.I)(e)}}return await(0,et.l)(a.tankerContext,d,{username:t,password:n,remember_username:o,refresh_token:u}),{redirect:c}},[p.a.VERIFICATION_CODE_STEP]:async()=>({}),[p.a.MARKETING_OPT_IN_STEP]:async()=>({})};var it=n(88282);const st=(e,t)=>(0,g.Tq)()?(e=>{const t=(0,it.Q)();return e?m.A.t("appointments.login_or_signup.authentication_choice_step.title_portal",{portal_name:t}):m.A.t("appointments.login_or_signup.email_step.label_out_of_booking_portal",{portal_name:t})})(e):e?m.A.t("appointments.login_or_signup.authentication_choice_step.title"):t?m.A.t("api.accounts.index.root.anonymous_funnel.sign_up_sign_in_title"):m.A.t("appointments.login_or_signup.email_step.label_out_of_booking"),lt=(e,t)=>{let{propertiesToOmit:n,propertiesToMerge:o}=t;const a=(0,r.A)(e,null!==n&&void 0!==n?n:[]);return{...(0,i.A)(a,o)}};const ct=(e,t)=>!1===e&&t===p.a.LOGIN_STEP,ut=async(e,t,n,o)=>{const a=[p.a.VERIFY_PHONE_NUMBER_STEP,p.a.VERIFY_EMAIL_STEP].includes(t)?p.a.USERNAME_SIGN_UP_STEP:t,r="/sessions/new/".concat(a),i=await Ge.A.getOmniauthLoginUrl({username:e,redirection:n,from:r,context:o}).catch((()=>null));return i&&null!==i&&void 0!==i&&i.login_with_idp?i.redirection:""},dt=async(e,t,n,o)=>{const a=await Ge.A.getOmniauthSignupUrl({redirection:t,from:e,context:n,force_idp:o}).catch((()=>null));return null!==a&&void 0!==a&&a.redirection?a.redirection:""},mt=e=>{let{username:t,currentStepPath:n,funnelId:r,inBooking:i,formApi:m,profileId:_,appointmentId:h,redirection:v,isAnonymousFunnel:g,anonymousResourceType:y,anonymousResourceId:E,customTrackingDetails:A,context:b,fromIdp:f,utmSource:N,utmCampaign:S,utmMedium:x}=e;const T=(0,a.useNavigate)(),w=f?l.Jt("last-used-username"):"",I={username:t||w||l.Jt("last-login-username"),remember_username:!0},P=[we,Re,Ce,ke,Me,Oe,je,Ue],{userConversionKind:R,cp2uVersion:O}=(0,F.WL)(null!==y&&void 0!==y?y:F.OO.APPOINTMENT,!!y),[j,C]=(0,o.useState)({loading:!1,data:I,tankerContext:(0,o.useContext)(c.to),login:(0,u.vz)(),inBooking:i,isNewUser:P.some((e=>e.path===n)),isPhoneNumberFlow:!1,isAnonymousFunnel:g,funnelId:r,continueButtonDisabled:!1,redirection:v,profileId:_,anonymousResourceType:y,anonymousResourceId:E,cp2uVersion:O,currentStepTitle:"",context:b&&"other"!==b?b:R||"other"}),{steps:k,stepsForRoutes:M}=Je(j),U=((e,t)=>{const n=e.substring(e.lastIndexOf("/")+1);return t.find((e=>e.path===n))||Te})(n,M);(0,o.useEffect)((()=>{var e,t,o;if(!k.find((e=>e.path===n)))return;const a=function(e,t){if(!e)return!1;const n=Object.keys(e),o=Object.keys(t),a=n.filter((e=>"isNewUser"!==e&&!o.includes(e)));return Boolean(a.length)}(null===(e=m.current)||void 0===e?void 0:e.values,I);var r,i;if(!He.P.isFormFilledIn(a,U.path,k))return null===(r=m.current)||void 0===r||r.resetAll(),void T({pathname:"."},{state:{username:null===(i=m.current)||void 0===i?void 0:i.values.username}});null===(t=m.current)||void 0===t||t.resetAll(),null===(o=m.current)||void 0===o||o.setValues(j.data)}),[U]),(0,o.useEffect)((()=>{const e=U.path===p.a.AUTHENTICATION_CHOICE_STEP?{...A,source:"navigation_bar"===j.context?"navbar":j.context}:A,t={name:U.trackingName,appointmentId:h,profileId:Number(_)||void 0,funnelId:r,inBooking:j.inBooking,customDetails:e};if($e(t),U.productEvent){const e={context:j.context,cp2u_version:j.cp2uVersion};U.path===p.a.AUTHENTICATION_CHOICE_STEP&&(e.utm_source=N,e.utm_medium=x,e.utm_campaign=S),Ze(U.productEvent,e)}}),[U.trackingName,U.path,U.productEvent,h,_,j.inBooking,A,r,j.context,N,x,S,j.cp2uVersion]);const D=null!==new URLSearchParams(window.location.search).get("force_idp"),L=U.path===p.a.AUTHENTICATION_CHOICE_STEP?st(i,g):U.title;return{steps:k,state:j,currentStep:{...U,cardTitle:L},stepsForRoutes:M,onModalSubmit:async e=>{C((e=>lt(e,{propertiesToMerge:{continueButtonDisabled:!0}})));const{nextStepPath:t,stateInfo:n}=await rt[U.path]({values:e,state:j,steps:k});C((e=>lt(e,{propertiesToMerge:{...n,continueButtonDisabled:!1}})));const o=()=>{T(t?"./".concat(t).concat(window.location.search):"/sessions/new")};return ct(i,t)&&((0,Be.kT)()||(0,Be.I$)())?(async()=>{var e;const t=await ut(null===n||void 0===n||null===(e=n.data)||void 0===e?void 0:e.username,U.path,null===j||void 0===j?void 0:j.redirection,b||"other");return t?(0,d.A)(t,{replace:!0}):o()})():o()},onModalDismiss:()=>{C((e=>lt(e,{propertiesToMerge:{continueButtonDisabled:!1},propertiesToOmit:["showModal"]})))},onStepSubmit:async e=>{var t;C((t=>lt(t,{propertiesToMerge:{data:e,continueButtonDisabled:!0,loading:!0},propertiesToOmit:["error","showModal"]})));const{error:n,errorData:o,nextStepPath:a,redirect:l,stateInfo:c,showModal:u,submitTrackingDetails:v}=await rt[U.path]({values:e,state:j,steps:k}),g=null!==(t=null===c||void 0===c?void 0:c.isPhoneNumberFlow)&&void 0!==t?t:j.isPhoneNumberFlow,y=((e,t,n)=>e===p.a.USERNAME_SIGN_UP_STEP||e===p.a.LOGIN_STEP?{phone_success:n&&Boolean(t),mail_success:n&&!t}:{success:n})(U.path,g,!n),E=(e=>He.P.isAccountCreationStep(e.path)?"create_account_confirm_gdpr":"".concat(e.trackingName,"_validate"))(U),f={name:E,appointmentId:h,profileId:_?+_:void 0,funnelId:r,inBooking:j.inBooking,details:y,customDetails:U.path===p.a.AUTHENTICATION_CHOICE_STEP?{...A,...v,source:"navigation_bar"===b?"navbar":b||"other"}:{...A,...v}};if($e(f),U.onSubmitProductEvent&&Ze(U.onSubmitProductEvent,{context:b||"other"}),u||C((e=>lt(e,{propertiesToMerge:{continueButtonDisabled:!1,...c,loading:!1}}))),!(0,s.A)(n)||u)return C((e=>lt(e,{propertiesToMerge:{error:n,errorData:o,showModal:u,loading:!1}})));const N=()=>{var e;if(l){const e=new URL(l,window.location.origin);e.searchParams.set("authentication_kind",j.isNewUser?"signup":"login"),e.searchParams.set("context",null!==b&&void 0!==b?b:"other");const t=e.toString().replace(window.location.origin,"");return(0,d.A)(t,{replace:!0})}return T({pathname:"./".concat(a||""),search:window.location.search},{state:{username:null===(e=m.current)||void 0===e?void 0:e.values.username}})};if(ct(i,a)&&((0,Be.kT)()||(0,Be.I$)()))return(async()=>{const t=await ut(e.username,U.path,null===j||void 0===j?void 0:j.redirection,b||"other");return t?(0,d.A)(t,{replace:!0}):N()})();if(!1===i&&a===p.a.USERNAME_SIGN_UP_STEP){const e=await dt("/sessions/new",null===j||void 0===j?void 0:j.redirection,b||"other",D);if(e)return(0,d.A)(e,{replace:!0})}return N()},onChangeForm:e=>{C((t=>lt(t,{propertiesToMerge:{data:e}})))}}}},24779:(e,t,n)=>{n.d(t,{A:()=>g});var o=n(40519),a=n(6462),r=n(68381),i=n(64422),s=n(89482),l=n(3126),c=n(26399),u=n(24449),d=n(68707),m=n(7303),p=n(40233),_=n(81478),h=n(18809);const v=e=>{let{appointmentPrice:t,appointmentStartDate:n,cloudinaryPublicId:o,titleComponent:a,onBack:r,currentStep:i,includedInExperience:s}=e;const l=(0,p.y)("identification"),c=i.title;return n?i.path===_.a.AUTHENTICATION_CHOICE_STEP?s?(0,h.jsx)(d.A,{title:c,onBack:r}):(0,h.jsx)(d.A,{title:c,steps:l.config,onBack:r}):s?(0,h.jsx)(d.A,{title:c,onBack:r,titleComponent:a}):(0,h.jsx)(m.A,{onBack:r,cloudinaryPublicId:o,appointmentPrice:t,appointmentStartDate:n}):(0,h.jsx)(d.A,{title:c,onBack:r,titleComponent:a})},g=e=>{let{children:t,onBack:n,cloudinaryPublicId:d,appointmentPrice:m,appointmentStartDate:p,currentStep:_}=e;const[g,y]=(0,s.useState)(!1),[E]=(0,r.useSearchParams)(),A=E.get("redirect_reason"),{useExperience:b}=(0,s.useContext)(c.Ay),{included:f,experienceReady:N}=b("obk_authentication_mobile_web",p);(0,s.useEffect)((()=>{if(A===i.A.PasswordExpired)y(!0)}),[A]);return N?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(v,{onBack:n,cloudinaryPublicId:d,appointmentPrice:m,appointmentStartDate:p,currentStep:_,titleComponent:"p",includedInExperience:f}),(0,h.jsx)(a.A,{className:"dl-justify-center",children:(0,h.jsx)(o.A,{children:t})}),g&&(0,h.jsx)(l.A,{onHide:()=>{y(!1)}})]}):(0,h.jsx)(u.x,{})}},38155:(e,t,n)=>{n.d(t,{A:()=>s,f:()=>r});var o=n(49346),a=n(30079);let r=function(e){return e.MALE="male",e.FEMALE="female",e.DIVERSE="diverse",e.INDETERMINATE="indeterminate",e}({});const i=[{label:o.A.t("patient_mobile.root.account.edit.gender.male"),value:r.MALE},{label:o.A.t("patient_mobile.root.account.edit.gender.female"),value:r.FEMALE},{label:o.A.t("patient_mobile.root.account.edit.gender.diverse"),value:r.DIVERSE},{label:o.A.t("patient_mobile.root.account.edit.gender.indeterminate"),value:r.INDETERMINATE}],s=()=>"de"===(0,a.JJ)()?i:[{label:o.A.t("patient_mobile.root.account.edit.gender.male"),value:r.MALE},{label:o.A.t("patient_mobile.root.account.edit.gender.female"),value:r.FEMALE}]},13139:(e,t,n)=>{n.d(t,{u:()=>o});let o=function(e){return e.Male="male",e.Female="female",e.Indeterminate="indeterminate",e.Diverse="diverse",e}({})},25709:(e,t,n)=>{n.d(t,{h:()=>a});var o=n(30079);const a=()=>!(0,o.kT)()||(0,o.nJ)()}}]);
//# sourceMappingURL=../9678-ab44b80da4561018db74.js.map