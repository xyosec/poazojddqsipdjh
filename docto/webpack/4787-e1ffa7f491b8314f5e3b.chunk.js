(self.webpackChunkdoctolib=self.webpackChunkdoctolib||[]).push([[4787],{88838:(e,t,n)=>{"use strict";n.d(t,{Fx:()=>r});var o=n(18972),a=n(75791);const i=e=>function(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((r,s)=>{try{n&&o.$O&&n.append("secretaryship_account_id",o.$O);const l=new XMLHttpRequest;l.open(e,t);const c=(0,a.o0)();Object.keys(c).forEach((e=>l.setRequestHeader(e,c[e])));const{timeout:d,checkHttpStatus:u}=i,p=d?setTimeout((()=>l.abort()),d):void 0;l.onload=e=>{try{var t;const{responseText:n,status:o}=e.target;if(p&&clearTimeout(p),(null===(t=l.getAllResponseHeaders())||void 0===t?void 0:t.toLowerCase().indexOf("x-csrf-token"))>=0){const e=l.getResponseHeader("X-CSRF-Token");e&&(0,a.vW)(e)}u&&!(e=>e>=200&&e<300)(o)?s(new Error("Http request failed with status : ".concat(o))):r({responseBody:n,status:o})}catch(e){s(e)}},l.onerror=e=>s(new Error("An error occured in FileUploader: ".concat(e.message))),l.onabort=e=>s(new Error("An abort error occured in FileUploader: ".concat(e.message))),l.send(n)}catch(e){s(e)}}))},r=i("POST");i("PATCH"),i("PUT"),i("DELETE")},16264:(e,t,n)=>{"use strict";n.d(t,{A:()=>c,V:()=>l});var o=n(49346),a=n(30079),i=n(81277),r=n(42724),s=n(18809);const l="3.2.33",c=e=>{let{show:t,text:n,onHide:l,title:c,trackRedirectToSettings:d}=e;return(0,s.jsx)(r.l,{show:t,title:c,acceptText:(0,a.lV)()?o.A.t("patient_mobile.root.configuration.settings"):o.A.t("common.got_it"),onAccept:()=>{null===l||void 0===l||l(),(0,a.lV)()&&(async()=>{null===d||void 0===d||d(),await i.ct.call({method:"openSettings"})})()},dismissText:(0,a.lV)()?o.A.t("common.actions.cancel"):"",onDismiss:l,children:n})}},76312:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var o=n(89482),a=n(31330),i=n(10244),r=n(3877),s=n(40874);const l=e=>{const[t,n]=(0,o.useState)(),l=(0,a.Ay)(),c=(0,i.Ay)(),{startTanker:d,checkTankerStatus:u}=(0,o.useContext)(r.to);(0,o.useEffect)((()=>{e&&(async()=>{if(!c)return;const{isReady:e,verifiedEmail:t}=await u(c);n(e&&!!t)})()}),[]);const p=(0,o.useCallback)((async e=>{if(!c)return!1;const t=await d(c,{enforceFullRegistration:!0});return(0,s.bK)(t,c)&&(await u(c)).verifiedEmail?(n(!0),!0):(l({message:e,uiStyle:"error"}),!1)}),[c,d]),m=(0,o.useCallback)((async n=>{if(!c||!e||!t){if(!await p(n))return!1}return!0}),[c,e,p,t]);return{tankerStatusLoaded:void 0!==t,tankerIsReady:t,enrollInTanker:m}}},33818:(e,t,n)=>{"use strict";n.d(t,{M:()=>i,o:()=>r});var o=n(89482),a=n(18809);const i=(0,o.createContext)({}),r=e=>{let{defaultKind:t,children:n}=e;const r=(0,o.useMemo)((()=>({defaultKind:t})),[t]);return(0,a.jsx)(i.Provider,{value:r,children:n})}},9348:(e,t,n)=>{"use strict";n.d(t,{A:()=>We});var o=n(86254),a=n(89482),i=n(36036),r=n(33029),s=n(41978),l=n(63388),c=n(49346),d=n(46961),u=n(8787),p=n(81277),m=n(69447),_=n(30079);const h=new(n(25101).F2)(window.translation_keys||{});h.locale="root";const g=async e=>new Promise(((t,n)=>{const o=new FileReader;o.onload=e=>{t(e.target.result)},o.onerror=()=>n(o.error),o.onabort=()=>n(o.error),o.readAsArrayBuffer(e)})),f=(e,t)=>{const n=h.t("number.human.storage_units.format");return h.numberToHumanSize(e,{format:n,...t})},v="application/pdf",x="image/png",A="image/jpeg",y=[v,x,A],w=e=>{const t=new Uint8Array(e).subarray(0,4);let n="";for(let e=0;e<t.length;e++)n+=t[e].toString(16);return"25504446"===n?v:"89504e47"===n?x:"ffd8"===n.slice(0,4)?A:void 0};var b=n(49564),E=n(31330),T=n(83157),j=n(24449),D=n(16264),S=n(84583),k=n.n(S),P=n(12811),N=n.n(P),I=n(49551),C=n(70093),R=n(18809);function F(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e,t){return((e,t)=>{const n=new RegExp(t.replace(/\s+/g,"").replace(/,/g,"|").replace(/\*/,".+"));return!(!e.match(n)||!e.match(n)[0].length)})(e,t.replace("text/plain","text/*"))}class O extends a.Component{constructor(e){super(e),F(this,"state",{fileName:"",focused:!1,error:null}),F(this,"handleBlur",(e=>{this.setState({focused:!1}),this.props.onBlur&&this.props.onBlur(e)})),F(this,"handleFocus",(e=>{this.setState({focused:!0}),this.props.onFocus&&this.props.onFocus(e)})),F(this,"handleChange",(async e=>{if(!e.target.files.length)return;this.props.onLoadingAndValidatingFile&&this.props.onLoadingAndValidatingFile();const t=e.target.files[0],n=e.target.value.split(/(\\|\/)/g).pop(),o=await g(t),a=t.type||w(o),i=new File([o],n,{type:a});if(void 0!==this.props.maxSize&&i.size>this.props.maxSize){this.fileInput.current.value="";const t=c.A.t("common.file_too_big",{size:f(this.props.maxSize)});return this.setState({error:t}),void(this.props.onError&&this.props.onError(e,"file_too_big",t))}if(this.props.accept&&!this.props.skipTypeValidation&&!M(i.type,this.props.accept)){this.fileInput.current.value="";const t=c.A.t("common.file_type_invalid");return this.setState({error:t}),void(this.props.onError&&this.props.onError(e,"file_type_invalid",t))}this.setState({fileName:n,error:null}),this.props.onChange&&this.props.onChange(e,i)})),this.fileInput=e.fileInputRef||(0,a.createRef)()}render(){const{fileName:e}=this.state,{onBlur:t,onChange:n,onFocus:o,onError:a,children:i,uiStyle:r,className:s,required:l,maxSize:c,disabled:d,fileInputRef:u,capture:p,hidden:m,onLoadingAndValidatingFile:_,skipTypeValidation:h,...g}=this.props,f=!(a&&m)&&this.state.error;return(0,R.jsxs)("div",{className:k()("dl-file-input",s,{["dl-file-input-".concat(r)]:r}),"data-design-system":"base",children:[(0,R.jsx)("input",{className:k()("dl-file-input-input",{["dl-file-input-".concat(r,"-input")]:r}),onBlur:this.handleBlur,onChange:this.handleChange,onFocus:this.handleFocus,ref:this.fileInput,type:"file",disabled:d,capture:p,required:!e&&l,tabIndex:m?-1:void 0,"aria-hidden":m,...g}),m?null:i||(0,R.jsx)(I.A,{icon:(0,R.jsx)(N(),{}),focused:this.state.focused,placeholder:this.props.filename||this.props.placeholder,tabIndex:-1,value:e,readOnly:!0,validationState:this.state.error?"error":null}),f&&(0,R.jsx)(C.E,{color:"error-090",children:this.state.error})]})}}var U=n(33858),L=n(24370),q=n(47815),V=n(13543),z=n(97584);let H=function(e){return e.FileTooBig="file_too_big",e.FileTypeInvalid="file_type_invalid",e.FilePermissionError="file_permission_error",e.TitleTooLong="title_too_long",e.BackendError="backend_error",e.GenericError="generic_error",e}({});const G={processing:!1,pages:[],pageIndex:0,metadata:!1};function B(e,t){const n=[...e.pages];switch(t.type){case"PROCESSING":return{...e,processing:!0};case"ADD_PAGE":return{...e,pages:[...e.pages.slice(0,e.pageIndex+1),t.page,...e.pages.slice(e.pageIndex+1)],pageIndex:n.length?e.pageIndex+1:0,processing:!1};case"ADD_PAGES":return{...e,pages:[...e.pages.slice(0,e.pageIndex+1),...t.pages,...e.pages.slice(e.pageIndex+1)],pageIndex:e.pageIndex+t.pages.length-(n.length?0:1),processing:!1};case"SET_PAGE_INDEX":return{...e,pageIndex:t.pageIndex};case"REMOVE_PAGE":return 1===e.pages.length?{...G}:(n.splice(e.pageIndex,1),{...e,pages:n,pageIndex:e.pageIndex>0?e.pageIndex-1:0});case"ADD_DOCUMENT_METADATA":return{...e,metadata:!0};case"RESET":return G;default:throw new Error}}var $=n(33350),X=n(63235),W=n(42724);const J=e=>{let{show:t,onAccept:n,onDismiss:o}=e;return(0,R.jsx)(W.l,{title:"doctor"===window.platforms.businessUnit?c.A.t("doctor_mobile.root.new_document.quit_dialog.title"):c.A.t("patient_mobile.root.new_document.quit_dialog.title"),dismissText:c.A.t("common.actions.cancel"),onDismiss:o,acceptText:c.A.t("common.actions.quit"),onAccept:n,show:t,children:"doctor"===window.platforms.businessUnit?c.A.t("doctor_mobile.root.new_document.quit_dialog.body"):c.A.t("patient_mobile.root.new_document.quit_dialog.body")})};var K=n(3877),Z=n(55820),Q=n(57208),Y=n(34294),ee=n(38605),te=n(59957),ne=n(14632),oe=n(916),ae=n(92457);async function ie(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{file:a,orientation:i,corners:r,cropped:s}=e,l=await t.loadOrientedImage(a,i,n?void 0:1024);s&&r&&t.cropAndRotate(a,l,r);const c=await((e,t)=>new Promise(((n,o)=>{try{e.toBlob((e=>{e?n(e):o(new Error("Unable to build blob from canvas"))}),t)}catch(e){o(e)}})))(l,a.type);return o?new File([c],a.name,{type:a.type}):c}var re=n(68723),se=n(6996),le=n(35725),ce=n(48363),de=n(10244),ue=n(88838),pe=n(79003);const me=e=>e&&e.length>pe.N?{isTitleValid:!1,validationErrorMessage:c.A.t("patient_common.root.documents.error_title_too_long")}:{isTitleValid:!0,validationErrorMessage:""};var _e=n(84909),he=n(50342),ge=n(53566),fe=n(17881),ve=n(14688),xe=n(38898),Ae=n(41556),ye=n(99847),we=n(57713),be=n(3736),Ee=n(16980),Te=n(76606),je=n(57761),De=n(44308);const Se=e=>{let{name:t,options:n,"aria-label":o,onChange:i,context:r}=e;const[s,d]=(0,a.useState)([]),u=(0,De.yV)();return(0,a.useEffect)((()=>{null!==u&&(0,Te.cP)({...je.MG,details:{context:r,personalized_services_consent_status:u}})}),[u]),(0,R.jsx)(we.Z,{bgColor:"neutral-010",children:(0,R.jsxs)("div",{className:"flex flex-col gap-8 text-left",children:[(0,R.jsx)(be.F,{name:t,"aria-label":o,options:n,onSelect:e=>{const t=Boolean(e.length);(0,Te.cP)({...t?je.zi:je.yh,details:{context:r,personalized_services_consent_status:u}}),d(e),null===i||void 0===i||i(t)},type:"checkbox",value:s,contentClassName:"flex",className:"dl-flex-grow"}),(0,R.jsx)(fe.f,{color:"shared/text/bodyText/weak",children:c.A.t("patient_common.root.user_consent.checkbox_description")}),(0,R.jsxs)(Ee.A,{className:"dl-flex-row gap-4 items-center dl-text-s",href:l.Ay.PATIENT_LEGAL_INFO_LINKS.personalized_services_policy,target:"_blank",children:[c.A.t("patient_common.root.user_consent.footer.external_link_label"),(0,R.jsx)(ee.I,{"aria-label":c.A.t("common.open_new_tab"),name:"up-right-from-square",color:"primary-110"})]})]})})};var ke=n(47392);const Pe=e=>{let{onChange:t,documentDriveEnabled:n}=e;const[o,i]=(0,a.useState)([]),r=[{value:"save_to_drive",render:()=>(0,R.jsxs)("div",{children:[(0,R.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,R.jsx)(fe.f,{font:"Body/S/Bold",color:"shared/text/bodyText/weak",children:c.A.t("patient_common.root.documents.drive.consent.save_document.label")}),(0,R.jsx)(ee.I,{color:"success-110",name:"solid/lock",size:"xsmall"})]}),(0,R.jsx)(fe.f,{color:"inherit",children:n?c.A.t("patient_common.root.documents.drive.consent.save_document.description_with_global_consent"):c.A.t("patient_common.root.documents.drive.consent.save_document.description_without_global_consent")})]})}];return(0,R.jsx)(be.F,{name:"save_to_drive","aria-label":c.A.t("patient_common.root.documents.drive.consent.save_document.label_aria"),options:r,onSelect:e=>{i(e),t(Boolean(e.length))},type:"checkbox",value:o,contentClassName:"flex",className:"dl-flex-grow"})},Ne="enable_personalized_services",Ie=e=>{let{formApi:t,show:n}=e;const o=(0,de.Ay)(),i=(0,ye.yV)(),r=(0,ye.WO)(o),{activated:s}=(0,ye.Mn)("document_drive"),l=(0,a.useMemo)((()=>r&&!s),[r,s]),d=ke.o.DOCUMENT_UPLOAD;(0,a.useEffect)((()=>{i&&(0,Te.cP)({...je.Tf,details:{context:d,personalized_services_consent_status:i}})}),[i]);const u=e=>{null!==i&&(0,Te.cP)({...je.Ze,details:{context:d,personalized_services_consent_status:i}}),t.setValue(Ne,e)};if(!n)return null;if(!r)return(0,R.jsx)(Pe,{onChange:e=>t.setValue("save_to_drive",e),documentDriveEnabled:Boolean(s)});if(l){const e=[{value:Ne,label:c.A.t("patient_common.root.documents.drive.consent.save_document.label_activate_personalized_services_html")}];return(0,R.jsx)(Se,{name:Ne,options:e,"aria-label":c.A.t("patient_common.root.documents.drive.consent.save_document.label_aria"),onChange:u,context:d})}return null};var Ce=n(33818);const Re=e=>{var t,o;let{documentScanner:i,encryptDocument:r,encryptDocumentTitle:s,fetchDocuments:d,masterPatients:u,onUpload:p,onAdd:m,onHide:h,pages:g,shared:v=!1,source:x}=e;const{defaultKind:A}=(0,a.useContext)(Ce.M)||{},y={title:(null===(t=g[0])||void 0===t?void 0:t.title)||"",master_patient_id:1===u.length?null===(o=u[0])||void 0===o?void 0:o.id:void 0,save_to_drive:x===$.p.DocumentDrive||x===$.p.Native,kind:A,enable_personalized_services:!1},w=l.Ay.PATIENT_ACCOUNT_DOCUMENTS.KINDS,[b,j]=(0,a.useState)(!1),D=(0,de.Ay)(),{fetchAccount:S}=(0,de.BL)(),{activated:P}=(0,ye.Mn)("document_drive"),{mutateAsync:N}=(0,se.i)({name:re.N.DOCUMENT_DRIVE}),{mutateAsync:I}=(0,Ae.j)({source:"document_sharing",onError:()=>null,onSuccess:()=>null}),{data:F}=(0,_e.NY)(y.master_patient_id||"",{enabled:!!y.master_patient_id}),M=(0,E.Ay)(),O=(0,_.kT)(),U=(0,T.A)(),L=!!x&&[$.p.AppointmentRequest,$.p.AppointmentView,$.p.PatientRequest].includes(x),[G,B]=(0,a.useState)(y.title),[X,W]=(0,a.useState)(me(G).isTitleValid?void 0:"error"),[J,K]=(0,a.useState)(""),Z=(0,a.useContext)(q.P),Q=e=>{let{errorType:t,message:n}=e;U.current&&j(!1),M({message:n||c.A.t("common.error"),uiStyle:"error"}),(0,V.$)(z.m9,{document_upload_funnel_id:Z.document_upload_funnel_id,context:Z.context,document_flow:Z.document_flow,document_error_type:t})};return(0,R.jsx)(ae.A,{className:"flex flex-col h-full overflow-hidden",horizontal:!1,onSubmit:async e=>{let{kind:t,master_patient_id:o,title:a,save_to_drive:u,enable_personalized_services:v}=e;U.current&&j(!0);const x=!P&&L&&(u||v);!function(e){let{needToActivateDocumentDrive:t,save_to_drive:n,withPersonalizedServices:o,productEventDetails:a}=e;const i=t?ge.TJ.EnablePhrAndAddToPhr:n||o?ge.TJ.AddToPhr:ge.TJ.NoConsent;(0,V.$)(z.sb,{document_upload_funnel_id:a.document_upload_funnel_id,context:a.context,document_flow:a.document_flow,document_upload_consent_type:i})}({needToActivateDocumentDrive:x,save_to_drive:u,withPersonalizedServices:Boolean(v||P&&(0,ye.WO)(D)),productEventDetails:Z}),x&&(v?await I({enabled:!0}):u&&await N({value:"enabled"}));const A=new FormData;let y;if(g.length>1&&i)y=await(async(e,t,o)=>{const a=await n.e(8375).then(n.bind(n,8375)),i=await a.PDFDocument.create(),r=(await Promise.all(e.map((async e=>{let{file:n,orientation:a,corners:i,cropped:r}=e;const s=await t.loadOrientedImage(n,a,o?void 0:1024);return r&&i&&t.cropAndRotate(n,s,i),{canvas:s,type:n.type}})))).map((e=>{let{canvas:t,type:n}=e;return new Promise((e=>{const o=i.addPage([t.width,t.height]);("image/jpeg"===n?i.embedJpg(t.toDataURL(n)):i.embedPng(t.toDataURL(n))).then((n=>{o.drawImage(n,{x:0,y:0,width:t.width,height:t.height}),e(null)}))}))}));return await Promise.all(r),new File([await i.save()],"".concat((new Date).toISOString(),".pdf"),{type:"application/pdf"})})(g,i,!1);else if(g[0]&&"application/pdf"!==g[0].file.type&&(0,_.G9)()&&i)y=await ie(g[0],i,!1,!0);else{if(!g[0])return;y=g[0].file}if(y.size>l.Ay.DOCUMENT_MAX_SIZE)Q({errorType:H.FileTooBig,message:c.A.t("common.file_too_big",{size:f(l.Ay.DOCUMENT_MAX_SIZE)})});else{null===m||void 0===m||m(y);try{const[e,n]=await Promise.all([r(y,(0,oe.D4)(o)),a?s(a,(0,oe.D4)(o)):null]);A.append("tanker_encrypted",(!0).toString()),A.append("page_count",g.length.toString()),A.append("file",e),A.append("kind",m?"patient_request_attachment":t),A.append("master_patient_id",o.toString()),A.append("save_to_drive",u.toString()),a&&A.append("title",a),n&&A.append("tanker_encrypted_title",n);const{responseBody:i,status:l}=await(0,ue.Fx)("/account/documents",A);if(l>=400)Q({errorType:H.BackendError});else{const{document:e}=JSON.parse(i);h({documentWasSaved:!0}),await(e=>{let{needToActivateDocumentDrive:t}=e;const n=[];return d&&n.push(d()),t&&n.push(S()),Promise.all(n)})({needToActivateDocumentDrive:x}),function(e){let{productEventDetails:t}=e;(0,z.hQ)(t.document_flow)&&(0,V.$)(z.xT,{document_upload_funnel_id:t.document_upload_funnel_id,context:t.context,document_flow:t.document_flow})}({productEventDetails:Z}),p(e),U.current&&j(!1)}}catch(e){Q({errorType:H.GenericError})}}},defaultValues:y,children:e=>(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(ve.c,{alignText:"left",children:(0,R.jsxs)("div",{className:"flex flex-col gap-24 h-full justify-between",children:[(0,R.jsxs)("div",{className:"flex flex-col gap-24",children:[(0,R.jsx)(te.S,{name:"title",label:c.A.t("patient_common.root.documents.name_of_document"),placeholder:c.A.t("patient_common.root.documents.name_of_document"),value:G,maxlength:pe.N,state:X,message:J,showRequirementLabel:!0,onChange:t=>{const n=me(t.target.value);n.isTitleValid&&e.setValue("title",t.target.value.trim()),B(t.target.value),W(n.isTitleValid?void 0:"error"),K(n.validationErrorMessage),""===J&&n.validationErrorMessage&&(0,V.$)(z.m9,{document_upload_funnel_id:Z.document_upload_funnel_id,context:Z.context,document_flow:Z.document_flow,document_error_type:H.TitleTooLong})},customStyle:["w-full","mb-[-20px]"]}),(0,R.jsx)(ne.l,{required:!0,name:"kind",label:c.A.t("patient_common.root.documents.type_of_document"),placeholder:c.A.t("patient_common.root.documents.select_type"),value:e.values.kind||"",options:w.map((e=>({value:e,label:(0,le.HL)(e)}))),onChange:t=>{e.setValue("kind",t.target.value)},customStyle:["w-full"],dropdownFloatingStrategy:"fixed"}),F?(0,R.jsxs)("div",{className:"dl-text-left",children:[(0,R.jsx)(C.E,{component:"h3",children:(0,R.jsx)("strong",{children:c.A.t("patient_common.root.documents.patient_linked")})}),(0,R.jsxs)("div",{className:"flex mt-4",children:[(0,R.jsx)(he.V,{masterPatient:F,size:"xsmall"}),(0,R.jsx)(C.E,{align:"left",color:"neutral-090",uiStyle:"body-s-regular",children:(0,ce.GP)(F)})]})]}):(0,R.jsx)(ne.l,{required:!0,name:"master_patient_id",label:c.A.t("patient_common.root.documents.patient_linked"),placeholder:c.A.t("patient_common.root.documents.select_patient_linked"),options:u.map((e=>({value:e.id.toString(),label:(0,ce.GP)(e)}))),onChange:t=>{e.setValue("master_patient_id",t.target.value)},customStyle:["w-full"],dropdownFloatingStrategy:"fixed"}),(0,R.jsx)(Ie,{formApi:e,show:L})]}),(0,R.jsxs)("div",{children:[(0,R.jsxs)("div",{className:"flex gap-8 dl-justify-center dl-align-items-center",children:[!L&&(0,R.jsx)(ee.I,{color:"success-110",name:"solid/lock",size:"xsmall"}),(0,R.jsx)(fe.f,{color:"shared/text/minorText/weak",font:"Body/S/Regular",children:c.A.t("patient_common.root.documents.end_to_end.desc_mobile")})]}),L&&!(0,ye.WO)(D)&&(0,R.jsx)("div",{className:"flex dl-justify-center dl-align-items-center",children:(0,R.jsx)(C.E,{children:c.A.t("patient_common.root.patient_privacy_settings.document_drive_modal.learn_more_html",{url:l.Ay.PATIENT_LEGAL_INFO_LINKS.document_drive_policy,class:"dl-link dl-link-flat"})})})]})]})}),(0,R.jsx)(xe.j,{children:(0,R.jsxs)("div",{className:k()("flex",{"self-end":O}),children:[O&&(0,R.jsx)(Y.$,{uiStyle:"tertiary-neutral",className:"dl-margin-r",onClick:()=>h(),children:c.A.t("common.actions.cancel")}),(0,R.jsx)(Y.$,{block:!O,type:"submit",disabled:"error"===X||!e.values.kind||!e.values.master_patient_id,loadable:{loading:b},children:v?c.A.t("patient_common.root.documents.share"):c.A.t("patient_common.root.documents.add")})]})})]})})};var Fe=n(50767);const Me=e=>{let{show:t,onAccept:n,onDismiss:o,trackingDetails:i}=e;const r=(0,a.useContext)(b.A);return(0,R.jsx)(W.l,{title:"doctor"===window.platforms.businessUnit?c.A.t("doctor_mobile.root.new_document.remove_page_dialog.title"):c.A.t("patient_mobile.root.new_document.remove_page_dialog.title"),dismissText:c.A.t("common.actions.cancel"),onDismiss:o,acceptText:c.A.t("common.actions.confirm"),onAccept:e=>{(0,Te.Cq)({schema:"clinical",name:"scan_document__trash_page_dialog__accepted",team:"BEAR",details:{...r,...i}}),n(e)},show:t,children:"doctor"===window.platforms.businessUnit?c.A.t("doctor_mobile.root.new_document.remove_page_dialog.body"):c.A.t("patient_mobile.root.new_document.remove_page_dialog.body")})};var Oe=n(68069);const Ue=e=>{let{pages:t,pageIndex:n,setPageIndex:o,scrollableRef:a}=e;return(0,R.jsx)("div",{ref:a,className:"dl-document-upload-scrollable mt-16",children:(0,R.jsx)(Oe.Ay,{enableMouseEvents:!0,index:n,hysteresis:.3,className:"dl-full-height",containerStyle:{margin:"0px 30px",height:"100%"},onChangeIndex:o,onSwitching:()=>{setTimeout((()=>{a.current&&(a.current.scrollTop=0)}),300)},children:t.map(((e,t)=>(0,R.jsx)("div",{className:"dl-flex-center dl-full-height",children:(0,R.jsx)("img",{"data-displayed":n===t,className:"dl-full-width dl-padding-x-8",src:e.previewDataURL})},t)))})})};var Le=n(16254);const qe=e=>{let{pages:t,pageIndex:n,setPageIndex:o}=e;return(0,R.jsxs)(R.Fragment,{children:[((0,_.kT)()||t.length>1)&&(0,R.jsx)("div",{className:"dl-text-center",style:{visibility:t.length>1?"visible":"hidden"},children:(0,R.jsx)(Le.X,{index:n,total:t.length,onIndexChange:o,label:e=>c.A.t("patient_common.root.documents.pagination_accessibility_label",{current_page_index:e+1,total_pages:t.length})})}),(0,R.jsx)(fe.f,{font:"Body/XS/Bold",color:"shared/text/minorText/weak",customStyle:["text-center"],children:"doctor"===window.platforms.businessUnit?c.A.t("doctor_mobile.root.new_document.page_count",{currentPage:n+1,count:t.length}):c.A.t("patient_mobile.root.new_document.page_count",{currentPage:n+1,count:t.length})})]})},Ve=e=>{let{isDisabled:t,iconName:n,label:o,onClick:a}=e;return(0,R.jsx)(Fe.K0,{disabled:t,label:o,onClick:a,name:n,size:"xlarge",uiStyle:"neutral"})},ze=e=>{let{pages:t,pageIndex:n,processing:o,uploadFile:i,dispatch:r,trackEvent:s}=e;const[l,d]=(0,a.useState)(!1),u=(0,a.useRef)(),p=e=>{r({type:"SET_PAGE_INDEX",pageIndex:e})},m=(0,_.G9)()?ve.c:Q.ys,h=(0,_.G9)()?xe.j:Q.tb;return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(m,{children:(0,R.jsx)(Ue,{scrollableRef:u,setPageIndex:p,pageIndex:n,pages:t})}),(0,R.jsxs)(h,{divider:(0,_.kT)(),children:[(0,R.jsx)(qe,{pages:t,setPageIndex:p,pageIndex:n}),(0,R.jsxs)("div",{className:"flex items-start justify-around",children:[(0,R.jsx)(Ve,{isDisabled:o,onClick:()=>{i(),s({name:"patient_new_page_upload_document"})},iconName:"regular/plus",label:c.A.t("patient_mobile.root.new_document.add_page")}),(0,R.jsx)(Ve,{isDisabled:o,onClick:()=>{d(!0)},iconName:"regular/trash-can",label:c.A.t("patient_mobile.root.new_document.remove_page")})]}),(0,R.jsx)(Y.$,{block:!_.kT,className:"!mt-24 dl-margin-b",disabled:!t.length||o,onClick:()=>{r({type:"ADD_DOCUMENT_METADATA"}),s({name:"patient_continue_upload_document"})},children:c.A.t("common.actions.continue")}),(0,R.jsx)(Me,{show:l,onAccept:()=>{r({type:"REMOVE_PAGE"}),s({name:"patient_delete_page_upload_document"}),d(!1)},onDismiss:()=>d(!1),trackingDetails:void 0})]})]})},He=e=>{let{show:t,title:n,onHide:o,children:a}=e;return(0,_.G9)()?(0,R.jsx)(Q.Ay,{show:t,title:n,onHide:o,size:"fullscreen","data-test":"document-upload-form",children:a}):(0,R.jsx)(X.a,{show:t,title:n,onHide:o,size:"medium",dataTest:"document-upload-form",children:a})},Ge=e=>{let{onHide:t,onUpload:n,onAdd:o,uploadFile:i,agendaId:r,masterPatients:s,multiPageInfos:l,dispatch:d,documentScanner:u,trackEvent:p,shared:m,source:h,fetchDocuments:g}=e;const{encryptFile:f,encryptRecord:v}=(0,a.useContext)(K.to),x=(0,a.useContext)(b.A),[A,y]=(0,a.useState)(!1),{processing:w,pages:E,pageIndex:T,metadata:D}=l,S=function(){var e;let{documentWasSaved:n=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o="application/pdf"===(null===(e=E[0])||void 0===e||null===(e=e.file)||void 0===e?void 0:e.type);E.length&&(0,_.G9)()&&!o&&!n?y(!0):t()},k=w&&0===E.length;return(0,R.jsxs)(He,{show:E.length>0||k,title:m?c.A.t("patient_common.root.documents.share_document"):c.A.t("patient_common.root.documents.add_new_document"),onHide:()=>S(),children:[k?(0,R.jsx)(j.x,{}):D?(0,R.jsx)(Re,{encryptDocument:async(e,t)=>(0,Z.r)({agendaId:r,encryptFile:f,fileToUpload:e,masterPatientId:t,trackingContext:x}),encryptDocumentTitle:async(e,t)=>(0,Z.C)({title:e,masterPatientId:t,encryptRecord:v}),fetchDocuments:g,masterPatients:s,pages:E,onUpload:n,onAdd:o,documentScanner:u,onHide:S,trackEvent:p,shared:m,source:h}):(0,R.jsx)(ze,{processing:w,pages:E,pageIndex:T,uploadFile:i,dispatch:d,trackEvent:p}),(0,R.jsx)(J,{show:A,onAccept:()=>{t(),y(!1)},onDismiss:()=>y(!1)})]})},Be=e=>{e.current&&(e.current.value="")},$e="granted",Xe=e=>{var t,o,h;let{agendaId:f,displayCameraFileInput:v,fetchDocuments:x,onUpload:A,onAdd:S,onError:k,children:P,startTankerOnMount:N,source:I=$.p.DocumentDrive,masterPatients:C,shared:F=!1,showLoader:M=!1,className:X,enrollInTanker:W,tankerIsReady:J}=e;const[K,Z]=(0,a.useState)((0,i.A)()),[Q,Y]=(0,a.useState)(),[ee,te]=(0,a.useState)(!1),ne=(0,a.useRef)(null),[oe,ae]=(0,a.useState)(!1),[ie,re]=(0,a.useState)(!1),se=(0,T.A)(),le=(0,a.useContext)(b.A),ce=(0,a.useContext)(q.P),de=(0,a.useCallback)((e=>{let{name:t,details:n}=e;(0,m.Ay)({name:t,details:{source:I,funnel_id:K,is_appointment_request:I===$.p.AppointmentRequest,is_appointment_request_enabled:(0,U.G7)("patient_appointment_requests"),...le,...ne.current&&{source_type:ne.current},...n}},{schema:"patient"})}),[K,le,I]);(0,a.useEffect)((()=>{Promise.all([n.e(3365),n.e(1340)]).then(n.bind(n,31340)).then((e=>{se.current&&Y(e)}))}),[se]),(0,a.useEffect)((()=>{Q&&I===$.p.Native&&p.ct.call({method:"bridgeReady",params:["native_upload"]})}),[Q,I]);const ue=(0,a.useRef)(),pe=(0,a.useRef)(),me=(0,E.Ay)(),[_e,he]=(0,a.useReducer)(B,G),{data:ge}=(0,L.I)({enabled:!C,shouldUseMasterPatientSignedIds:!0}),fe=C||(null===ge||void 0===ge?void 0:ge.bodyData),ve=(null===(t=window.platforms)||void 0===t?void 0:t.reactNative)&&(0,d.fi)("3.2.27"),xe=(null===(o=window.platforms)||void 0===o?void 0:o.reactNative)&&(null===(h=window.platforms)||void 0===h?void 0:h.android)&&(0,d.fi)("3.2.33"),Ae=()=>{var e;return null===(e=ue.current)||void 0===e?void 0:e.click()},ye=c.A.t("patient_mobile.root.configuration.camera_access_for_documents");(0,a.useEffect)((()=>{xe&&p.ct.call({method:"checkCameraPermission",params:[]}).then((e=>{ae(e)}))}),[xe]);const we=(0,a.useCallback)((async e=>{try{const t=await(async e=>{const t=await g(e),n=w(t);return-1!==y.indexOf(n)})(e);if(!t)return me({message:c.A.t("common.file_type_invalid"),uiStyle:"error"}),(0,V.$)(z.m9,{document_upload_funnel_id:ce.document_upload_funnel_id,context:ce.context,document_flow:ce.document_flow,document_error_type:H.FileTypeInvalid}),!1}catch(t){if(t instanceof DOMException&&"NotReadableError"===t.name)return me({message:c.A.t("common.file_permission_error",{name:e.name}),uiStyle:"error"}),(0,V.$)(z.m9,{document_upload_funnel_id:ce.document_upload_funnel_id,context:ce.context,document_flow:ce.document_flow,document_error_type:H.FilePermissionError}),!1;throw t}return!0}),[ce,me]),be=()=>{var e;"upload_from_camera"===ne.current?null===(e=pe.current)||void 0===e||e.click():Ae()},Ee=async(e,t)=>{try{if(!await we(e))return Be(t),void te(!1)}catch(e){throw Be(t),te(!1),e}const n=(0,_.G9)();if(n&&_e.pages.length||(de({name:"patient_upload_document"}),(0,_.G9)()&&(0,V.$)(z.MO,{document_upload_funnel_id:ce.document_upload_funnel_id,context:ce.context,document_flow:ce.document_flow})),n&&"application/pdf"!==e.type){if(he({type:"PROCESSING"}),!Q)return;const t=await Q.readFileWithPreview(e);he({type:"ADD_PAGE",page:t})}else he({type:"ADD_PAGE",page:{file:e}}),he({type:"ADD_DOCUMENT_METADATA"});te(!1)},Te=(0,a.useCallback)((async e=>{let{detail:t}=e;if(t.method===u.Wn){if(_e.metadata)return;const e=(0,i.A)();Z(e);if(!await W(c.A.t("tanker.must_verify_identity.document")))return;de({name:"patient_upload_document",details:{funnel_id:e}}),(0,_.G9)()&&(0,V.$)(z.MO,{document_upload_funnel_id:ce.document_upload_funnel_id,context:ce.context,document_flow:ce.document_flow});const n=await Promise.all(t.data.files.map((async e=>{let{fileName:t,base64data:n}=e;const o=await(async e=>{let{fileName:t,base64data:n}=e;const o=function(){switch((arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toLowerCase()){case"pdf":return"application/pdf";case"jpg":return"image/jpeg";case"png":return"image/png";default:return}}(t.split(".").at(-1)),a="data:".concat(o,";base64,").concat(n),i=await fetch(a),r=await i.blob();return new File([r],t,{type:o})})({fileName:t,base64data:n});if(!await we(o))return;if(!Q)return;return{...await Q.readFileWithPreview(o),title:t}}))),[o,a]=(0,r.A)((0,s.A)(n),(e=>"application/pdf"===e.file.type));o.length?(he({type:"RESET"}),he({type:"ADD_PAGE",page:{...o[0]}}),he({type:"ADD_DOCUMENT_METADATA"})):he({type:"ADD_PAGES",pages:a})}}),[Q,W,we,de,_e.metadata,he,ce]),je=(e,t,n)=>{me({message:n,uiStyle:"error"}),te(!1),k&&k(e,t,n)};return(0,a.useEffect)((()=>{if(I===$.p.Native)return window.addEventListener("reactNativeEvent",Te),()=>{window.removeEventListener("reactNativeEvent",Te)}}),[Te,I]),null!==fe&&void 0!==fe&&fe.length?N&&void 0===J?M?(0,R.jsx)(j.x,{}):null:(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(O,{hidden:!0,fileInputRef:ue,accept:"image/jpeg, image/png, application/pdf",maxSize:l.Ay.DOCUMENT_MAX_SIZE,onChange:(e,t)=>Ee(t,ue),onError:je,className:X,onLoadingAndValidatingFile:()=>te(!0)}),v&&(0,R.jsx)(O,{hidden:!0,capture:!0,id:"camera-file-input",fileInputRef:pe,accept:"image/*",maxSize:l.Ay.DOCUMENT_MAX_SIZE,onChange:(e,t)=>Ee(t,pe),onError:je,className:X,onLoadingAndValidatingFile:()=>te(!0)}),null===P||void 0===P?void 0:P({onClick:async(e,t)=>{ne.current=t||null;const n=(0,i.A)();Z(n);await W(c.A.t("tanker.must_verify_identity.document"))&&(ve?oe?be():p.ct.call({method:"requestCameraPermission",params:[]}).then((e=>{e===$e?be():(0,d.fi)(D.V)&&re(!0),ae(e===$e)})):be())},loadingAndValidatingFile:ee}),(0,R.jsx)(Ge,{onUpload:A,onAdd:S,uploadFile:Ae,agendaId:f,multiPageInfos:_e,dispatch:he,documentScanner:Q,masterPatients:fe,onHide:()=>{he({type:"RESET"}),Be(ue),Be(pe)},trackEvent:de,shared:F,source:I,fetchDocuments:x}),(0,R.jsx)(D.A,{show:ie,onHide:()=>{re(!1),be()},title:c.A.t("patient_mobile.root.configuration.camera_access"),text:ye})]}):null},We=e=>(0,R.jsx)(o.A,{component:"DocumentUpload",team:"phr",children:(0,R.jsx)(Xe,{...e})})},33350:(e,t,n)=>{"use strict";n.d(t,{p:()=>o});let o=function(e){return e.DocumentDrive="document_drive",e.Native="native",e.AppointmentRequest="appointment_request",e.AppointmentView="appointment_view",e.PatientRequest="patient_request",e}({})},41556:(e,t,n)=>{"use strict";n.d(t,{A:()=>o.Al,j:()=>o.j4});var o=n(91376)},53566:(e,t,n)=>{"use strict";n.d(t,{EH:()=>o,MJ:()=>i,T0:()=>a,TJ:()=>r});let o=function(e){return e.FreeUpload="free_upload",e.DocumentRequest="document_request",e.PatientRequest="patient_request",e.D2P="d2p",e.AppointmentRequest="appointment_request",e.PatientHealthRecord="patient_health_record",e.NativeUpload="native_upload",e}({}),a=function(e){return e.BookingFunnel="booking_funnel",e.AnonymousView="anonymous_view",e.Messaging="messaging",e.PatientHealthRecord="patient_health_record",e.MyAppointmentsView="my_appointments_view",e}({}),i=function(e){return e.PatientHealthRecord="patient_health_record",e.UploadFromCamera="upload_from_camera",e.UploadFromDevice="upload_from_device",e}({}),r=function(e){return e.EnablePhrAndAddToPhr="enable_phr_and_add_to_phr",e.AddToPhr="add_to_phr",e.NoConsent="no_consent",e}({})},97584:(e,t,n)=>{"use strict";n.d(t,{HJ:()=>u,Lm:()=>a,MO:()=>r,O:()=>s,XL:()=>p,hQ:()=>_,m9:()=>m,q$:()=>d,sb:()=>l,x1:()=>i,xT:()=>c});var o=n(53566);const a={name:"document__add_document_button__clicked"},i={name:"document__source_button__clicked"},r={name:"document__preview_add_button__clicked"},s={name:"document__select_button__clicked"},l={name:"document__submit_button__clicked"},c={name:"document__upload_document_confirmed_toast__viewed"},d={name:"document__send_documents_card_section__viewed"},u={name:"document__send_documents_button__clicked"},p={name:"document__send_documents_page__viewed"},m={name:"document__upload_document_error__viewed"},_=e=>e===o.EH.FreeUpload||e===o.EH.PatientHealthRecord||e===o.EH.D2P||e===o.EH.NativeUpload},12811:(e,t,n)=>{var o=n(89482);const a=o.forwardRef((function(e,t){return o.createElement("svg",{...e,ref:t},o.createElement("path",{d:"M1.5 18.54A4.7 4.7 0 0 1 0 15.16c-.03-1.3.54-2.58 1.7-3.86L11.8 1.23C12.87.14 14.04-.22 15.31.13c.6.16 1.13.48 1.6.95.48.48.8 1.01.96 1.61.35 1.3-.01 2.5-1.1 3.58L7.15 15.9c-.54.54-1.14.85-1.79.93a1.9 1.9 0 0 1-1.62-.57c-.4-.32-.59-.83-.55-1.5.04-.68.36-1.3.96-1.87l6.74-6.79c.33-.35.66-.35 1.02 0s.35.7 0 1.02l-6.75 6.74c-.6.6-.73 1.07-.4 1.43a.66.66 0 0 0 .48.12c.33-.06.64-.23.94-.53l9.63-9.63c.67-.68.9-1.41.69-2.2a2.05 2.05 0 0 0-1.55-1.54c-.73-.19-1.46.06-2.19.73L2.72 12.28c-.9 1.03-1.32 2-1.3 2.9.03.91.38 1.7 1.06 2.38.68.65 1.47 1 2.38 1.02.9.03 1.86-.4 2.86-1.26L17.8 7.28c.32-.32.66-.32 1.01 0 .36.3.36.62 0 .98L8.74 18.33A5.21 5.21 0 0 1 4.96 20a4.56 4.56 0 0 1-3.46-1.46z"}))}));a.defaultProps={width:"20",height:"20",viewBox:"0 0 20 20"},e.exports=a,a.default=a}}]);
//# sourceMappingURL=../4787-fc7592a644d214a96ee5.js.map